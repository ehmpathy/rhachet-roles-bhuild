# distill: platform architecture

## key decisions

### authentication
- use oauth 2.0 with pkce for all client types
- jwt access tokens with 15-minute expiry
- refresh token rotation on each use
- redis-based session store for server sessions

### data persistence
- postgresql as primary datastore
- redis cache with event-based invalidation
- event sourcing for audit-critical operations

### real-time
- native websockets for browser clients
- redis pub/sub for message distribution
- presence service with heartbeat tracking

### analytics
- clickhouse for analytical queries
- kafka for event streaming
- pre-computed daily aggregates

### multi-tenancy
- row-level security in postgresql
- tenant context in all requests
- per-tenant configuration table

### rate limiting
- token bucket algorithm
- redis counters for distributed state
- per-endpoint limit configuration

## architecture constraints

1. all services must be stateless for horizontal scaling
2. all database queries must include tenant filter
3. all events must include correlation id for tracing
4. all external calls must have circuit breakers
5. all caches must have explicit invalidation strategy

## implementation priorities

phase 1: authentication + basic persistence
phase 2: real-time notifications
phase 3: analytics dashboard
phase 4: multi-tenant isolation hardening
phase 5: rate limiting and quotas
