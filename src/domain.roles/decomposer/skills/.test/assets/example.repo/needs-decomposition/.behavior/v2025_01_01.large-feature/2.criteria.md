# usecase.1 = user authentication

given('a user with valid credentials')
  when('user submits login form')
    then('system validates credentials against identity provider')
    then('system creates session token with configurable expiry')
    then('system returns authentication response with tokens')

given('a user with invalid credentials')
  when('user submits login form')
    then('system rejects with appropriate error code')
    then('system increments failed attempt counter')
    then('system locks account after threshold exceeded')

# usecase.2 = data persistence

given('an entity to persist')
  when('entity is saved')
    then('system writes to primary datastore')
    then('system invalidates relevant cache entries')
    then('system emits domain event for subscribers')

given('a cached entity')
  when('entity is updated')
    then('system updates primary datastore')
    then('system invalidates cache entry')
    then('system propagates invalidation to replicas')

# usecase.3 = real-time notifications

given('a subscribed client')
  when('relevant event occurs')
    then('system pushes notification via websocket')
    then('system tracks delivery status')
    then('system retries on delivery failure')

given('a disconnected client')
  when('notification is pending')
    then('system queues notification for later delivery')
    then('system delivers on reconnection')

# usecase.4 = analytics dashboard

given('an authenticated admin')
  when('admin requests analytics')
    then('system aggregates data from event store')
    then('system applies configured filters')
    then('system renders visualization components')

given('a custom report request')
  when('report is generated')
    then('system queries data warehouse')
    then('system formats per report template')
    then('system caches for repeated access')

# usecase.5 = multi-tenant isolation

given('a tenant-scoped request')
  when('request is processed')
    then('system enforces tenant boundary')
    then('system applies tenant-specific config')
    then('system logs with tenant context')

given('cross-tenant data access attempt')
  when('access is denied')
    then('system returns authorization error')
    then('system logs security event')

# usecase.6 = rate limit

given('an api client')
  when('request rate exceeds limit')
    then('system returns 429 with retry-after header')
    then('system tracks rate limit state per client')

given('a quota-tracked operation')
  when('quota is consumed')
    then('system decrements available quota')
    then('system notifies on threshold breach')
