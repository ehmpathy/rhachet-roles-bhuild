# research: remote access requirements

> what remote repositories must be accessed to fulfill dispatcher radio?

---

## overview

the dispatcher radio feature requires access to two remote repositories:

| repository | interface | purpose |
|------------|-----------|---------|
| github issues | `gh` cli | persistent task storage, cross-repo dispatch |
| local filesystem | node `fs` / shell | local cache, symlinks, status flags |

---

## 1. github issues via `gh` cli

### 1.1 commands required

| operation | command | purpose |
|-----------|---------|---------|
| create task | `gh issue create` | push new task to channel |
| list tasks | `gh issue list` | pull task list |
| view task | `gh issue view` | pull specific task details |
| edit task | `gh issue edit` | update title, description, assignee |
| close task | `gh issue close` | mark task as delivered |
| check auth | `gh auth status` | verify authentication before operations |
| api calls | `gh api` | advanced queries, json output |

### 1.2 key contracts

#### `gh issue create`

> "you can create an issue with flags like `gh issue create --title "Issue title" --body "Issue body"`" [1]

flags:
- `--title` (required) — task title
- `--body` — task description
- `--assignee` — supports `@me` for self-assignment [1]
- `--repo` — target repository in `OWNER/REPO` format

#### `gh issue list`

> "you can list issues with commands like `gh issue list --label "bug"`, `gh issue list --author monalisa`, `gh issue list --assignee "@me"`, `gh issue list --search "error no:assignee sort:created-asc"`. you will see the most recent 30 open items." [1]

flags:
- `--state` — `open`, `closed`, or `all`
- `--search` — advanced search query
- `--json` — output as json with specified fields
- `--repo` — target repository

#### `gh issue edit`

> "to edit issues' projects requires authorization with the project scope. to authorize, run `gh auth refresh -s project`." [2]

flags:
- `--title` — update title
- `--body` — update body
- `--add-assignee` — assign users, supports `@me` [2]
- `--remove-assignee` — unassign users

examples from docs [2]:
```sh
gh issue edit 23 --title "I found a bug" --body "It is broken"
gh issue edit 23 --add-assignee "@me" --remove-assignee monalisa,hubot
```

#### `gh issue close`

> "close issue syntax: `gh issue close {<number> | <url>} [flags]`" [3]

flags:
- `--comment` — leave a close comment
- `--reason` — `completed` or `not planned`
- `--repo` — target repository

#### `gh auth status`

> "the `gh auth status` command verifies and displays information about your authentication state. this command will test your authentication state for each github host that gh knows about and report on any issues." [4]

used to detect authentication failures before operations.

### 1.3 json output

> "some gh commands support data export as json as an alternative to their usual line-based plain text output, suitable to pass structured data to scripts. the json output is enabled with the --json option, followed by the list of fields to fetch." [1]

this enables machine-readable output for task metadata parse.

### 1.4 authentication

#### environment variable

> "the `gh` cli will use the authentication token found in environment variables, which is most suitable for 'headless' use of gh such as in automation." [5]

> "to use gh in github actions, add `GH_TOKEN: ${{ github.token }}` to env." [5]

#### github app tokens

> "github cli only accepts access tokens as means of authentication. you can use your app to generate an access token on behalf of a user, but you will have to do so manually, as github cli can't help with that." [6]

> "you can use gh from a github app as long as you used the app to generate an authentication token for a user. you can either pass that token to `gh auth login --with-token` or you can set it to an environment variable, e.g. `export GH_TOKEN="..."`." [6]

#### token lifetime

> "github app installation tokens create an installation access token to make authenticated api requests. installation tokens expire 1 hour from the time you create them." [6]

#### security best practice

> "as a good security practice, you should always make sure that actions only have the minimum access they require via limited permissions granted to the GITHUB_TOKEN." [5]

### 1.5 repo context

> "placeholder values {owner}, {repo}, and {branch} in the endpoint argument will get replaced with values from the repository of the current directory or the repository specified in the GH_REPO environment variable." [1]

this enables default repo detection when inside a git repo.

---

## 2. local filesystem via node `fs` / shell

### 2.1 operations required

| operation | interface | purpose |
|-----------|-----------|---------|
| create directory | `fs.mkdir` / `mkdir -p` | bootstrap radio directories |
| write file | `fs.writeFile` | persist task files |
| read file | `fs.readFile` | read task content |
| create symlink | `fs.symlink` | link local `.radio/` to global |
| check exists | `fs.access` / `test -e` | detect prior files/symlinks |
| list files | `fs.readdir` / `ls` | enumerate tasks |
| rename file | `fs.rename` / `mv` | update status flag files |
| delete file | `fs.unlink` / `rm` | remove delivered status flags |

### 2.2 symlinks (unix only)

no windows support required. standard unix symlinks via:

```bash
ln -s ~/git/.radio/$owner/$repo .radio
```

or in node:

```javascript
fs.symlinkSync(target, path, 'dir');
```

### 2.3 directory structure

global radio directory:
```
~/git/.radio/
  ├─ readme.md                              # self-documentation
  └─ $owner/
      └─ $repo/
          ├─ readme.md                      # repo-specific docs
          ├─ task.{exid}._.md               # task content
          ├─ task.{exid}.bak.{isodate}.md   # backup on edit
          └─ task.{exid}._.status=OPEN.flag # status for glob
```

local symlink:
```
.radio/ → ~/git/.radio/$owner/$repo/
```

### 2.4 error handler requirements

robust error handler required for:
- directory already exists (bootstrap idempotency)
- symlink already exists (re-link)
- file not found (task lookup)

---

## 3. prior patterns in this repo

### 3.1 gh cli usage

from `.agent/repo=.this/role=any/skills/gh.workflow.logs.sh`:

```bash
# ensure gh cli is available
if ! command -v gh &> /dev/null; then
  echo "error: gh cli is not installed"
  exit 1
fi

# ensure we're authenticated
if ! gh auth status &> /dev/null; then
  echo "error: not authenticated with gh cli"
  exit 1
fi
```

pattern: check availability, check auth, then proceed with operations.

### 3.2 json output parse

```bash
# get latest run
RUNS_JSON=$(gh run list --branch $BRANCH --limit 1 --json databaseId,workflowName,status)

# extract run info
RUN_ID=$(echo "$RUNS_JSON" | jq -r '.[0].databaseId')
```

pattern: use `--json` flag for machine-readable output, parse with `jq`.

### 3.3 repo context

```bash
# get repo info for api calls
REPO=$(gh repo view --json nameWithOwner -q '.nameWithOwner')
```

pattern: query current repo context programmatically.

---

## 4. implementation recommendations

### 4.1 gh.issues adapter

1. **auth check first** — always verify `gh auth status` before operations
2. **json output** — use `--json` for all queries to enable reliable parse
3. **repo flag** — always support explicit `--repo` for cross-repo dispatch
4. **error map** — map gh cli errors to domain errors (not found, auth failed, etc)

### 4.2 os.fileops adapter

1. **bootstrap idempotently** — use findsert pattern for readme.md files
2. **symlink for local access** — link `.radio/` → global radio dir
3. **atomic writes** — write to temp file, then rename, for crash safety
4. **status via flags** — empty `.flag` files for fast glob queries

### 4.3 shared patterns

1. **repo resolution** — detect from git context, require explicit if outside
2. **backup on edit** — always create `.bak` before overwrite
3. **fail-fast validation** — validate inputs before any remote operation

---

## citations

[1] gh issue list, gh issue create, gh api — https://cli.github.com/manual/gh_issue_list, https://cli.github.com/manual/gh_issue_create, https://cli.github.com/manual/gh_api

[2] gh issue edit — https://cli.github.com/manual/gh_issue_edit

[3] gh issue close — https://cli.github.com/manual/gh_issue_close

[4] gh auth status — https://cli.github.com/manual/gh_auth_status

[5] github actions token authentication — https://docs.github.com/actions/security-guides/automatic-token-authentication

[6] gh cli with github apps — https://github.com/cli/cli/discussions/5095, https://github.com/cli/cli/discussions/5081
