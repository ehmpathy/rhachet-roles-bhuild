# roadmap: dispatcher radio implementation

> checklist-style execution plan with dependencies, acceptance criteria, and verification steps

---

## overview

this roadmap provides step-by-step execution guidance for the blueprint at `3.3.blueprint.v1.i1.md`.

each phase includes:
- [ ] checklist items with ordered dependencies
- ğŸ“š briefs to read before start
- âœ… acceptance criteria per item
- ğŸ” verification commands to run

---

## phase 0: foundation (domain objects)

> create core domain objects that all other code depends on

### ğŸ“š briefs to read

- [ ] `3.1.research.domain._.v1.md` â€” domain model patterns
- [ ] `3.1.research.domain.terms.v1.md` â€” ubiquitous language terms
- [ ] `3.2.distill.domain._.v1.i1.md` â€” distilled domain model

### ğŸ“‹ checklist

- [ ] **0.1** create `src/domain.objects/RadioTaskStatus.ts`
  - âœ… enum with QUEUED, CLAIMED, DELIVERED values
  - âœ… exports `isRadioTaskStatus` guard via `createIsOfEnum`
  - ğŸ” `npm run test:types`

- [ ] **0.2** create `src/domain.objects/RadioChannel.ts`
  - âœ… enum with GH_ISSUES = 'gh.issues', OS_FILEOPS = 'os.fileops'
  - âœ… exports `isRadioChannel` guard
  - ğŸ” `npm run test:types`

- [ ] **0.3** create `src/domain.objects/IdempotencyMode.ts`
  - âœ… enum with FINDSERT = 'findsert', UPSERT = 'upsert'
  - âœ… exports `isIdempotencyMode` guard
  - ğŸ” `npm run test:types`

- [ ] **0.4** create `src/domain.objects/RadioTaskRepo.ts`
  - âœ… DomainLiteral with owner: string, name: string
  - ğŸ” `npm run test:types`

- [ ] **0.5** create `src/domain.objects/RadioTask.ts`
  - âš ï¸ depends on: 0.1, 0.4
  - âœ… DomainEntity with exid, title, description, status, repo, pushedBy, pushedAt, claimedBy, claimedAt, deliveredAt, branch
  - âœ… static primary = ['exid']
  - âœ… static unique = ['repo', 'title']
  - âœ… static updatable = ['title', 'description', 'status', 'claimedBy', 'claimedAt', 'deliveredAt', 'branch']
  - âœ… static nested = { repo: RadioTaskRepo }
  - ğŸ” `npm run test:types`

### ğŸ” phase verification

```sh
npm run test:types
```

---

## phase 1: format utilities

> create utilities to convert RadioTask to/from channel-specific formats

### ğŸ“š briefs to read

- [ ] `3.1.research.patterns._.code.prod.v1.md` â€” production code patterns
- [ ] `3.1.research.patterns._.code.test.v1.i1.md` â€” test code patterns
- [ ] `1.vision.md` â€” task format specification (gh.issues and os.fileops sections)

### ğŸ“‹ checklist

- [ ] **1.1** create `src/domain.operations/radio/task/format/composeTaskIntoGhIssues.ts`
  - âš ï¸ depends on: phase 0
  - âœ… accepts `{ task: RadioTask }`
  - âœ… returns markdown string with ğŸ¦« dispatch header, ğŸ’§ enqueued section, ğŸŒ² tree section
  - âœ… title format: `ğŸ™ï¸ task: {title}`
  - ğŸ” `npm run test:types`

- [ ] **1.2** create `src/domain.operations/radio/task/format/composeTaskIntoGhIssues.test.ts`
  - âœ… unit tests for compose output format
  - âœ… snapshot tests for output
  - ğŸ” `npm run test:unit -- composeTaskIntoGhIssues`

- [ ] **1.3** create `src/domain.operations/radio/task/format/extractTaskFromGhIssues.ts`
  - âš ï¸ depends on: phase 0
  - âœ… accepts `{ issueNumber, title, body, state, assignees }`
  - âœ… returns RadioTask
  - âœ… extracts pushedBy, pushedAt from body
  - âœ… derives status from state + body content
  - ğŸ” `npm run test:types`

- [ ] **1.4** create `src/domain.operations/radio/task/format/extractTaskFromGhIssues.test.ts`
  - âœ… unit tests for extract from issue body
  - âœ… roundtrip test: compose â†’ extract returns equivalent task
  - ğŸ” `npm run test:unit -- extractTaskFromGhIssues`

- [ ] **1.5** create `src/domain.operations/radio/task/format/composeTaskIntoOsFileops.ts`
  - âš ï¸ depends on: phase 0
  - âœ… accepts `{ task: RadioTask }`
  - âœ… returns yaml frontmatter + markdown body
  - âœ… frontmatter includes exid, title, status, pushedBy, pushedAt, claimedBy, claimedAt, deliveredAt, branch
  - ğŸ” `npm run test:types`

- [ ] **1.6** create `src/domain.operations/radio/task/format/composeTaskIntoOsFileops.test.ts`
  - âœ… unit tests for compose output format
  - âœ… snapshot tests for output
  - ğŸ” `npm run test:unit -- composeTaskIntoOsFileops`

- [ ] **1.7** create `src/domain.operations/radio/task/format/extractTaskFromOsFileops.ts`
  - âš ï¸ depends on: phase 0
  - âœ… accepts `{ content: string }`
  - âœ… returns RadioTask
  - âœ… uses gray-matter to extract frontmatter
  - ğŸ” `npm run test:types`

- [ ] **1.8** create `src/domain.operations/radio/task/format/extractTaskFromOsFileops.test.ts`
  - âœ… unit tests for extract from file content
  - âœ… roundtrip test: compose â†’ extract returns equivalent task
  - ğŸ” `npm run test:unit -- extractTaskFromOsFileops`

### ğŸ” phase verification

```sh
npm run test:unit -- radio/task/format
```

---

## phase 2: dao adapters

> create dao adapters for each channel via declastruct pattern

### ğŸ“š briefs to read

- [ ] `3.1.research.access._.v1.md` â€” dao adapter patterns and gh cli usage
- [ ] `3.1.research.patterns._.code.prod.v1.md` â€” declastruct dao pattern
- [ ] `3.1.research.patterns._.code.test.v1.i1.md` â€” integration test patterns

### ğŸ“‹ checklist

- [ ] **2.1** create `src/access/daos/daoRadioTask/index.ts`
  - âš ï¸ depends on: phase 0
  - âœ… exports DaoRadioTask interface with get.one.byPrimary, get.one.byUnique, get.all, set.findsert, set.upsert, del
  - âœ… exports getDaoRadioTask factory that selects adapter by channel
  - ğŸ” `npm run test:types`

- [ ] **2.2** create `src/access/daos/daoRadioTask/daoRadioTaskViaGhIssues.ts`
  - âš ï¸ depends on: 2.1, phase 1 (format utilities)
  - âœ… implements DaoRadioTask interface
  - âœ… get.one.byPrimary uses `gh issue view`
  - âœ… get.one.byUnique uses `gh issue list --search`
  - âœ… get.all uses `gh issue list`
  - âœ… set.findsert: find first, create if not found
  - âœ… set.upsert: find first, update if found, create if not
  - âœ… del uses `gh issue close`
  - ğŸ” `npm run test:types`

- [ ] **2.3** create `src/access/daos/daoRadioTask/daoRadioTaskViaGhIssues.integration.test.ts`
  - âœ… integration tests against test repo
  - âœ… tests for create, read, update, close operations
  - âœ… tests for error handler (not found, auth failed)
  - ğŸ” `npm run test:integration -- daoRadioTaskViaGhIssues`

- [ ] **2.4** create `src/access/daos/daoRadioTask/daoRadioTaskViaOsFileops.ts`
  - âš ï¸ depends on: 2.1, phase 1 (format utilities), phase 3 (getRadioPath)
  - âœ… implements DaoRadioTask interface
  - âœ… get.one.byPrimary reads task file by exid
  - âœ… get.one.byUnique globs and matches by title
  - âœ… get.all globs for task files, optionally filtered by status flags
  - âœ… set.findsert: find first, write if not found
  - âœ… set.upsert: find first, backup + overwrite if found, write if not
  - âœ… manages status flag files (*._.status={STATUS}.flag)
  - ğŸ” `npm run test:types`

- [ ] **2.5** create `src/access/daos/daoRadioTask/daoRadioTaskViaOsFileops.integration.test.ts`
  - âœ… integration tests with temp directories
  - âœ… tests for file create, read, update, delete
  - âœ… tests for status flag file management
  - âœ… tests for backup file creation on upsert
  - ğŸ” `npm run test:integration -- daoRadioTaskViaOsFileops`

### ğŸ” phase verification

```sh
npm run test:integration -- daoRadioTask
```

---

## phase 3: utilities

> create git context utilities and radio directory bootstrap

### ğŸ“š briefs to read

- [ ] `3.1.research.access._.v1.md` â€” git and gh cli patterns
- [ ] `3.1.research.patterns._.code.test.v1.i1.md` â€” test patterns
- [ ] `1.vision.md` â€” radio directory structure specification

### ğŸ“‹ checklist

#### 3.1 git context utilities

- [ ] **3.1.1** create `src/infra/git/getRepoFromGitContext.ts`
  - âœ… returns RadioTaskRepo | null
  - âœ… uses `gh repo view --json nameWithOwner` or parses git remote
  - âœ… returns null if not in a git repo
  - ğŸ” `npm run test:types`

- [ ] **3.1.2** create `src/infra/git/getRepoFromGitContext.test.ts`
  - âœ… unit test for successful extraction
  - âœ… unit test for null when not in git repo
  - ğŸ” `npm run test:unit -- getRepoFromGitContext`

- [ ] **3.1.3** create `src/infra/git/getCurrentBranch.ts`
  - âœ… returns current git branch name
  - âœ… uses `git branch --show-current`
  - ğŸ” `npm run test:types`

- [ ] **3.1.4** create `src/infra/git/getCurrentBranch.test.ts`
  - âœ… unit test for branch extraction
  - ğŸ” `npm run test:unit -- getCurrentBranch`

- [ ] **3.1.5** create `src/infra/git/getCurrentActor.ts`
  - âœ… returns current git/gh user
  - âœ… uses `gh api user -q '.login'` or `git config user.name`
  - ğŸ” `npm run test:types`

- [ ] **3.1.6** create `src/infra/git/getCurrentActor.test.ts`
  - âœ… unit test for actor extraction
  - ğŸ” `npm run test:unit -- getCurrentActor`

#### 3.2 radio directory bootstrap

- [ ] **3.2.1** create `src/domain.operations/radio/bootstrap/getRadioPath.ts`
  - âš ï¸ depends on: phase 0 (RadioTaskRepo)
  - âœ… accepts `{ repo, exid?, variant: 'global' | 'local' }`
  - âœ… returns `{ radioDir, taskFile?, statusFlag?, backup? }`
  - âœ… global path: `~/git/.radio/$owner/$repo/`
  - âœ… local path: `.radio/` (symlink)
  - âœ… task file: `task.{exid}._.md`
  - âœ… status flag: `task.{exid}._.status={STATUS}.flag`
  - ğŸ” `npm run test:types`

- [ ] **3.2.2** create `src/domain.operations/radio/bootstrap/getRadioPath.test.ts`
  - âœ… unit tests for path computation
  - âœ… tests for global vs local variants
  - ğŸ” `npm run test:unit -- getRadioPath`

- [ ] **3.2.3** create `src/domain.operations/radio/bootstrap/bootstrapRadioDir.ts`
  - âš ï¸ depends on: 3.2.1
  - âœ… accepts `{ repo, cwd }`
  - âœ… findserts `~/git/.radio/readme.md`
  - âœ… findserts `~/git/.radio/$owner/$repo/readme.md`
  - âœ… findserts `.radio/` symlink â†’ global dir
  - âœ… returns `{ globalDir, localSymlink }`
  - ğŸ” `npm run test:types`

- [ ] **3.2.4** create `src/domain.operations/radio/bootstrap/bootstrapRadioDir.integration.test.ts`
  - âœ… integration tests with temp directories
  - âœ… tests for idempotent bootstrap (findsert behavior)
  - âœ… tests for symlink creation
  - ğŸ” `npm run test:integration -- bootstrapRadioDir`

### ğŸ” phase verification

```sh
npm run test:unit -- infra/git
npm run test:unit -- getRadioPath
npm run test:integration -- bootstrapRadioDir
```

---

## phase 4: skill operations

> create the main push and pull operations that compose dao and utilities

### ğŸ“š briefs to read

- [ ] `3.1.research.patterns._.code.prod.v1.md` â€” operation patterns
- [ ] `3.1.research.patterns._.code.test.v1.i1.md` â€” integration test patterns
- [ ] `2.1.criteria.blackbox.md` â€” acceptance criteria (for validation logic)

### ğŸ“‹ checklist

#### 4.1 push operations

- [ ] **4.1.1** create `src/domain.operations/radio/task/push/setFullRadioTask.ts`
  - âš ï¸ depends on: phase 2 (dao), phase 3 (bootstrap)
  - âœ… accepts `{ via, idem?, task: { repo, title, description } }`
  - âœ… uses dao.set.findsert or dao.set.upsert based on idem flag
  - âœ… generates exid if not provided (for new tasks)
  - âœ… sets pushedBy, pushedAt, status=QUEUED
  - âœ… returns `{ task, outcome: 'created' | 'found' }`
  - ğŸ” `npm run test:types`

- [ ] **4.1.2** create `src/domain.operations/radio/task/push/setFullRadioTask.via-gh-issues.integration.test.ts`
  - âœ… integration tests for create new task on gh.issues
  - âœ… tests for findsert idempotency
  - âœ… tests for upsert behavior
  - ğŸ” `npm run test:integration -- setFullRadioTask.via-gh-issues`

- [ ] **4.1.3** create `src/domain.operations/radio/task/push/setFullRadioTask.via-os-fileops.integration.test.ts`
  - âœ… integration tests for create new task on os.fileops
  - âœ… tests for findsert idempotency
  - âœ… tests for upsert behavior
  - ğŸ” `npm run test:integration -- setFullRadioTask.via-os-fileops`

- [ ] **4.1.4** create `src/domain.operations/radio/task/push/setPartRadioTask.ts`
  - âš ï¸ depends on: phase 2 (dao), phase 3 (utilities)
  - âœ… accepts `{ via, task: { exid } & Partial<{ repo, title, description, status }> }`
  - âœ… fetches found task via dao.get.one.byPrimary
  - âœ… validates status transitions (QUEUED â†’ CLAIMED â†’ DELIVERED)
  - âœ… on CLAIMED: sets claimedBy, claimedAt, branch (via getCurrentBranch, getCurrentActor)
  - âœ… on DELIVERED: sets deliveredAt, validates was CLAIMED first
  - âœ… creates backup on edit
  - âœ… returns `{ task, outcome: 'updated', backup? }`
  - ğŸ” `npm run test:types`

- [ ] **4.1.5** create `src/domain.operations/radio/task/push/setPartRadioTask.via-gh-issues.integration.test.ts`
  - âœ… integration tests for claim task (QUEUED â†’ CLAIMED)
  - âœ… integration tests for deliver task (CLAIMED â†’ DELIVERED)
  - âœ… integration tests for edit task (title, description)
  - âœ… tests for lifecycle order validation
  - âœ… tests for idempotent re-claim from same branch
  - âœ… tests for error on claim conflict (different branch)
  - ğŸ” `npm run test:integration -- setPartRadioTask.via-gh-issues`

- [ ] **4.1.6** create `src/domain.operations/radio/task/push/setPartRadioTask.via-os-fileops.integration.test.ts`
  - âœ… integration tests for claim task (QUEUED â†’ CLAIMED)
  - âœ… integration tests for deliver task (CLAIMED â†’ DELIVERED)
  - âœ… integration tests for edit task
  - âœ… tests for status flag file rename
  - âœ… tests for backup file creation
  - ğŸ” `npm run test:integration -- setPartRadioTask.via-os-fileops`

- [ ] **4.1.7** create `src/domain.operations/radio/task/push/radioTaskPush.ts`
  - âš ï¸ depends on: 4.1.1, 4.1.4, phase 3 (getRepoFromGitContext, bootstrapRadioDir)
  - âœ… accepts partial task input, resolves repo from git context if needed
  - âœ… validates --repo required if not in git repo
  - âœ… validates --title and --description required for new tasks
  - âœ… validates --exid required when --status specified
  - âœ… dispatches to setFullRadioTask (no exid) or setPartRadioTask (has exid)
  - âœ… bootstraps radio dir for os.fileops channel
  - ğŸ” `npm run test:types`

- [ ] **4.1.8** create `src/domain.operations/radio/task/push/radioTaskPush.via-gh-issues.integration.test.ts`
  - âœ… integration tests for dispatch logic
  - âœ… tests for validation errors
  - ğŸ” `npm run test:integration -- radioTaskPush.via-gh-issues`

- [ ] **4.1.9** create `src/domain.operations/radio/task/push/radioTaskPush.via-os-fileops.integration.test.ts`
  - âœ… integration tests for dispatch logic
  - âœ… tests for validation errors
  - âœ… tests for bootstrap on first push
  - ğŸ” `npm run test:integration -- radioTaskPush.via-os-fileops`

#### 4.2 pull operations

- [ ] **4.2.1** create `src/domain.operations/radio/task/pull/radioTaskPull.ts`
  - âš ï¸ depends on: phase 2 (dao), phase 3 (utilities)
  - âœ… overload: list tasks `{ via, repo?, all: { filter?, limit? } }`
  - âœ… overload: pull one `{ via, repo?, one: { exid } | { title } }`
  - âœ… resolves repo from git context if not provided
  - âœ… auto-caches to os.fileops when pull from remote channel
  - âœ… returns `{ tasks }` or `{ task, cached }`
  - ğŸ” `npm run test:types`

- [ ] **4.2.2** create `src/domain.operations/radio/task/pull/radioTaskPull.via-gh-issues.integration.test.ts`
  - âœ… integration tests for list tasks
  - âœ… integration tests for list with status filter
  - âœ… integration tests for pull specific task by exid
  - âœ… integration tests for auto-cache to os.fileops
  - âœ… tests for error on task not found
  - ğŸ” `npm run test:integration -- radioTaskPull.via-gh-issues`

- [ ] **4.2.3** create `src/domain.operations/radio/task/pull/radioTaskPull.via-os-fileops.integration.test.ts`
  - âœ… integration tests for list tasks
  - âœ… integration tests for list with status filter (via flag files)
  - âœ… integration tests for pull specific task by exid
  - âœ… tests for empty list
  - ğŸ” `npm run test:integration -- radioTaskPull.via-os-fileops`

### ğŸ” phase verification

```sh
npm run test:integration -- radio/task/push
npm run test:integration -- radio/task/pull
```

---

## phase 5: cli entry points

> create cli entry points and shell skills via portable-skills-pattern

### ğŸ“š briefs to read

- [ ] `.agent/repo=.this/role=any/briefs/portable-skills-pattern.md` â€” portable skills pattern
- [ ] `.agent/repo=.this/role=any/briefs/howto.test-skills.[lesson].md` â€” skill test guide

### ğŸ“‹ checklist

- [ ] **5.1** create `src/contract/cli/radioTaskPush.ts`
  - âš ï¸ depends on: phase 4 (radioTaskPush)
  - âœ… uses `getCliArgs({ schema })` for arg parse
  - âœ… validates --via channel is required
  - âœ… validates --via not specified twice
  - âœ… restructures flat cli args to nested input
  - âœ… formats output with ğŸ™ï¸ emoji
  - ğŸ” `npm run test:types`

- [ ] **5.2** create `src/contract/cli/radioTaskPull.ts`
  - âš ï¸ depends on: phase 4 (radioTaskPull)
  - âœ… uses `getCliArgs({ schema })` for arg parse
  - âœ… validates --via channel is required
  - âœ… --list flag triggers list mode
  - âœ… --exid triggers pull-one mode
  - âœ… formats output with ğŸ™ï¸ emoji
  - ğŸ” `npm run test:types`

- [ ] **5.3** update `src/index.ts`
  - âš ï¸ depends on: 5.1, 5.2
  - âœ… exports cliRadioTaskPush under cli.radioTaskPush
  - âœ… exports cliRadioTaskPull under cli.radioTaskPull
  - ğŸ” `npm run test:types`

- [ ] **5.4** create `src/domain.roles/dispatcher/skills/radio.task.push.sh`
  - âš ï¸ depends on: 5.3
  - âœ… uses portable-skills-pattern
  - âœ… uses `node -e "import('rhachet-roles-bhuild').then(m => m.cli.radioTaskPush())"` dispatch
  - ğŸ” `npm run build && npx rhachet run --skill radio.task.push --help`

- [ ] **5.5** create `src/domain.roles/dispatcher/skills/radio.task.pull.sh`
  - âš ï¸ depends on: 5.3
  - âœ… uses portable-skills-pattern
  - âœ… uses `node -e "import('rhachet-roles-bhuild').then(m => m.cli.radioTaskPull())"` dispatch
  - ğŸ” `npm run build && npx rhachet run --skill radio.task.pull --help`

### ğŸ” phase verification

```sh
npm run build
npx rhachet roles link --role dispatcher
npx rhachet run --skill radio.task.push --help
npx rhachet run --skill radio.task.pull --help
```

---

## phase 6: acceptance tests

> create blackbox acceptance tests that validate full skill contract

### ğŸ“š briefs to read

- [ ] `2.1.criteria.blackbox.md` â€” blackbox acceptance criteria (CRITICAL)
- [ ] `3.1.research.patterns._.code.test.v1.i1.md` â€” test patterns
- [ ] `.agent/repo=ehmpathy/role=mechanic/briefs/practices/code.test/frames.behavior/howto.write-bdd.[lesson].md` â€” bdd test structure

### ğŸ“‹ checklist

#### 6.1 push acceptance tests (gh.issues)

- [ ] **6.1.1** create `blackbox/role=dispatcher/skill.radio.task.push.via-gh-issues.acceptance.test.ts`
  - âš ï¸ depends on: phase 5
  - âœ… usecase.1: push new task to gh.issues
    - âœ… output shows broadcast confirmation
    - âœ… output shows created issue number
    - âœ… output shows pushed_by and pushed_at
    - âœ… output shows issue url
  - âœ… usecase.1: error cases
    - âœ… error: description is required
    - âœ… error: title is required
    - âœ… error: gh cli not authenticated
    - âœ… error: --repo required (not in a git repo)
  - âœ… usecase.3: claim task (QUEUED â†’ CLAIMED)
    - âœ… output shows task claimed
    - âœ… output shows "ğŸŒ² tree planted at {branch}"
    - âœ… issue is assigned to current user
    - âœ… issue description header is updated
    - âœ… idempotent re-claim from same branch succeeds
    - âœ… error: task already claimed by different branch
  - âœ… usecase.4: deliver task (CLAIMED â†’ DELIVERED)
    - âœ… output shows task delivered
    - âœ… output shows "ğŸŒ² tree delivered at {branch}"
    - âœ… issue is closed
    - âœ… error: cannot deliver unclaimed task
  - âœ… usecase.9: edit task with idempotency
    - âœ… task is updated with new title
    - âœ… backup created
    - âœ… findsert mode finds found task
    - âœ… error without --idem on mismatch
  - âœ… usecase.10: cross-repo dispatch
  - âœ… usecase.11: gh.issues task format
  - âœ… usecase.13: channel validation errors
    - âœ… error: --via channel is required
    - âœ… error: --via specified twice
  - âœ… usecase.14: edge cases
    - âœ… special characters in title
    - âœ… multiline description
    - âœ… invalid status value
    - âœ… --status without --exid
  - ğŸ” `npm run test:acceptance -- skill.radio.task.push.via-gh-issues`

#### 6.2 push acceptance tests (os.fileops)

- [ ] **6.2.1** create `blackbox/role=dispatcher/skill.radio.task.push.via-os-fileops.acceptance.test.ts`
  - âš ï¸ depends on: phase 5
  - âœ… usecase.2: push new task to os.fileops (current repo)
    - âœ… output shows task persisted to .radio/
    - âœ… task file exists at ~/git/.radio/$owner/$repo/task.{exid}._.md
    - âœ… task file is accessible via .radio/ symlink
    - âœ… task file contains frontmatter with pushed_by and pushed_at
    - âœ… status flag file exists at .radio/task.{exid}._.status=QUEUED.flag
  - âœ… usecase.2: bootstrap on first push
    - âœ… ~/git/.radio/$owner/$repo/ directory is created
    - âœ… ~/git/.radio/readme.md is findserted
    - âœ… ~/git/.radio/$owner/$repo/readme.md is findserted
    - âœ… .radio/ symlink is created
  - âœ… usecase.2b: cross-repo os.fileops
    - âœ… task is written to ~/git/.radio/$other_owner/$other_repo/
    - âœ… task is NOT accessible via current repo .radio/
    - âœ… output shows path to global radio dir
  - âœ… usecase.3: claim task (os.fileops)
    - âœ… task file frontmatter updated with claimed_by, claimed_at, branch
    - âœ… status flag file renamed to ._.status=CLAIMED.flag
    - âœ… task body updated with "ğŸŒ² tree planted at {branch}"
  - âœ… usecase.4: deliver task (os.fileops)
    - âœ… task file frontmatter updated with delivered_at
    - âœ… task body updated with "ğŸŒ² tree delivered at {branch}"
    - âœ… status flag file is removed
  - âœ… usecase.12: os.fileops task format
    - âœ… file has yaml frontmatter with exid, title, status, pushed_by, pushed_at
    - âœ… file body matches gh.issues format
  - ğŸ” `npm run test:acceptance -- skill.radio.task.push.via-os-fileops`

#### 6.3 pull acceptance tests (gh.issues)

- [ ] **6.3.1** create `blackbox/role=dispatcher/skill.radio.task.pull.via-gh-issues.acceptance.test.ts`
  - âš ï¸ depends on: phase 5
  - âœ… usecase.5: list tasks from gh.issues
    - âœ… output shows all tasks
    - âœ… each task shows exid, title, and status
    - âœ… tasks are prefixed with ğŸ™ï¸ emoji
    - âœ… output shows "no tasks found" when empty
  - âœ… usecase.7: pull specific task
    - âœ… output shows task details
    - âœ… output shows task cached to .radio/task.{exid}._.md
    - âœ… task file contains full details with frontmatter
    - âœ… error: task not found on channel
  - âœ… usecase.8: auto-cache on remote pull
    - âœ… task is fetched from gh.issues
    - âœ… task is auto-cached to .radio/task.{exid}._.md
    - âœ… status flag file is created
  - ğŸ” `npm run test:acceptance -- skill.radio.task.pull.via-gh-issues`

#### 6.4 pull acceptance tests (os.fileops)

- [ ] **6.4.1** create `blackbox/role=dispatcher/skill.radio.task.pull.via-os-fileops.acceptance.test.ts`
  - âš ï¸ depends on: phase 5
  - âœ… usecase.6: list tasks from os.fileops
    - âœ… output shows both tasks with status
    - âœ… fast status queries work via glob on flag files
    - âœ… output shows "no tasks cached locally" when empty
  - âœ… usecase.7: pull specific task (local)
    - âœ… output shows task details from local cache
  - âœ… usecase.2b: cross-repo pull via os.fileops
    - âœ… tasks are read from ~/git/.radio/$owner/$repo/
    - âœ… tasks are NOT cached to current repo .radio/
  - ğŸ” `npm run test:acceptance -- skill.radio.task.pull.via-os-fileops`

### ğŸ” phase verification

```sh
npm run test:acceptance -- role=dispatcher
```

---

## final verification

> run full test suite to verify complete implementation

### ğŸ“‹ checklist

- [ ] **F.1** run type checks
  ```sh
  npm run test:types
  ```

- [ ] **F.2** run unit tests
  ```sh
  npm run test:unit
  ```

- [ ] **F.3** run integration tests
  ```sh
  npm run test:integration
  ```

- [ ] **F.4** run acceptance tests
  ```sh
  npm run test:acceptance
  ```

- [ ] **F.5** run full test suite
  ```sh
  npm run test
  ```

- [ ] **F.6** manual smoke test
  ```sh
  # build and link
  npm run build
  npx rhachet roles link --role dispatcher

  # push a task
  npx rhachet run --skill radio.task.push \
    --via gh.issues \
    --title "test task" \
    --description "test description"

  # list tasks
  npx rhachet run --skill radio.task.pull \
    --via gh.issues \
    --list

  # pull specific task
  npx rhachet run --skill radio.task.pull \
    --via gh.issues \
    --exid {ISSUE_NUMBER}

  # verify local cache
  npx rhachet run --skill radio.task.pull \
    --via os.fileops \
    --list
  ```

---

## dependency graph

```
phase 0 (domain objects)
â”‚
â”œâ”€â”€ phase 1 (format utilities)
â”‚   â”‚
â”‚   â””â”€â”€ phase 2 (dao adapters)
â”‚       â”‚
â”‚       â””â”€â”€ phase 4 (skill operations)
â”‚           â”‚
â”‚           â””â”€â”€ phase 5 (cli entry points)
â”‚               â”‚
â”‚               â””â”€â”€ phase 6 (acceptance tests)
â”‚
â””â”€â”€ phase 3 (utilities)
    â”‚
    â””â”€â”€ phase 2 (dao adapters) [partial]
    â”‚
    â””â”€â”€ phase 4 (skill operations) [partial]
```

execution order: 0 â†’ 1 â†’ 3 â†’ 2 â†’ 4 â†’ 5 â†’ 6

note: phases 1 and 3 can run in parallel after phase 0 completes.

---

## summary

| phase | name               | items | deps         |
| ----- | ------------------ | ----- | ------------ |
| 0     | domain objects     | 5     | none         |
| 1     | format utilities   | 8     | 0            |
| 2     | dao adapters       | 5     | 0, 1, 3      |
| 3     | utilities          | 10    | 0            |
| 4     | skill operations   | 12    | 2, 3         |
| 5     | cli entry points   | 5     | 4            |
| 6     | acceptance tests   | 4     | 5            |
| F     | final verification | 6     | all          |
| **Î£** |                    | **55** |              |
