# roadmap: review.behavior

## dependencies

```
phase.0 (scaffolding)
   ↓
phase.1 (rule briefs)
   ↓
phase.2 (composite skill)
   ↓
phase.3 (symlinks + registration)
   ↓
phase.4 (validation)
```

---

## phase.0 = scaffolding

### deliverables
- [ ] directory structure created under `src/domain.roles/behaver/briefs/practices/`
- [ ] empty rule files scaffolded with headers

### tasks

- [ ] 0.1: create `src/domain.roles/behaver/briefs/practices/behavior.wish/` directory
- [ ] 0.2: create `src/domain.roles/behaver/briefs/practices/behavior.criteria/` directory
- [ ] 0.3: create `src/domain.roles/behaver/briefs/practices/behavior.blueprint/` directory
- [ ] 0.4: create `src/domain.roles/behaver/briefs/practices/behavior.roadmap/` directory
- [ ] 0.5: scaffold `rule.prefer.clear-desires.md` in behavior.wish/
- [ ] 0.6: scaffold `rule.prefer.bounded-scope.md` in behavior.wish/
- [ ] 0.7: scaffold `rule.require.bdd-format.md` in behavior.criteria/
- [ ] 0.8: scaffold `rule.prefer.usecase-groups.md` in behavior.criteria/
- [ ] 0.9: scaffold `rule.prefer.depth-groups.md` in behavior.criteria/
- [ ] 0.10: scaffold `rule.prefer.dependency-order.md` in behavior.criteria/
- [ ] 0.11: scaffold `rule.require.test-coverage-specified.md` in behavior.blueprint/
- [ ] 0.12: scaffold `rule.require.test-patterns-specified.md` in behavior.blueprint/
- [ ] 0.13: scaffold `rule.require.determinism-declared.md` in behavior.blueprint/
- [ ] 0.14: scaffold `rule.require.criteria-satisfied.md` in behavior.blueprint/
- [ ] 0.15: scaffold `rule.prefer.dependency-order.md` in behavior.roadmap/
- [ ] 0.16: scaffold `rule.prefer.clear-deliverables.md` in behavior.roadmap/

### acceptance criteria
```
given('phase.0 is complete')
  when('ls src/domain.roles/behaver/briefs/practices/')
    then('behavior.wish/, behavior.criteria/, behavior.blueprint/, behavior.roadmap/ exist')
  when('ls src/domain.roles/behaver/briefs/practices/behavior.wish/')
    then('rule.prefer.clear-desires.md and rule.prefer.bounded-scope.md exist')
  when('cat any rule file')
    then('file contains .rule, .what, .why, .how, .examples, .severity headers')
```

### verification
```sh
ls -la src/domain.roles/behaver/briefs/practices/
ls -la src/domain.roles/behaver/briefs/practices/behavior.*/
head -20 src/domain.roles/behaver/briefs/practices/behavior.wish/rule.prefer.clear-desires.md
```

---

## phase.1 = rule briefs

### dependencies
- [x] phase.0 complete (scaffolding exists)

### deliverables
- [ ] all 12 rule briefs fully implemented with content

### tasks

#### behavior.wish rules
- [ ] 1.1: implement `rule.prefer.clear-desires.md` content
  - .what, .why, .how with concrete examples
  - positive example: wish with explicit "wish =" and concrete desires
  - negative example: wish with vague or absent desires
- [ ] 1.2: implement `rule.prefer.bounded-scope.md` content
  - positive example: wish with explicit scope boundaries
  - negative example: wish with unbounded scope

#### behavior.criteria rules
- [ ] 1.3: implement `rule.require.bdd-format.md` content
  - positive example: given/when/then/sothat format
  - negative example: prose-style requirements
- [ ] 1.4: implement `rule.prefer.usecase-groups.md` content
  - positive example: `# usecase.N = description` headers
  - negative example: ungrouped given blocks
- [ ] 1.5: implement `rule.prefer.depth-groups.md` content
  - positive example: usecases grouped by abstraction depth (foundation → contract)
  - negative example: usecases scattered across abstraction layers
- [ ] 1.6: implement `rule.prefer.dependency-order.md` content
  - positive example: foundational usecases first
  - negative example: dependent usecases before their prerequisites

#### behavior.blueprint rules
- [ ] 1.7: implement `rule.require.test-coverage-specified.md` content
  - positive example: unit/integration/acceptance coverage declared
  - negative example: no test coverage section
- [ ] 1.8: implement `rule.require.test-patterns-specified.md` content
  - positive example: test patterns articulated (given/when/then, fixtures, mocks vs real)
  - negative example: no test pattern specification
- [ ] 1.9: implement `rule.require.determinism-declared.md` content
  - positive example: deterministic vs probabilistic classification
  - negative example: no determinism declaration
- [ ] 1.10: implement `rule.require.criteria-satisfied.md` content
  - positive example: blueprint addresses all criteria usecases
  - negative example: criteria usecases not addressed

#### behavior.roadmap rules
- [ ] 1.11: implement `rule.prefer.dependency-order.md` content
  - positive example: phases ordered by dependency
  - negative example: circular or out-of-order phases
- [ ] 1.12: implement `rule.prefer.clear-deliverables.md` content
  - positive example: each phase has deliverables section
  - negative example: phases without measurable outcomes

### acceptance criteria
```
given('phase.1 is complete')
  when('cat any rule file in behavior.wish/')
    then('.what, .why, .how sections have content')
    then('.examples.positive has at least one example')
    then('.examples.negative has at least one example')
    then('.severity is set to BLOCKER or NITPICK')
  when('wc -l on all rule files')
    then('each file has >20 lines of content')
```

### verification
```sh
for f in src/domain.roles/behaver/briefs/practices/behavior.*/rule.*.md; do
  echo "=== $f ==="
  grep -c ".what\|.why\|.how\|.positive\|.negative\|.severity" "$f"
done
```

---

## phase.2 = composite skill

### dependencies
- [x] phase.1 complete (rule briefs exist and have content)

### deliverables
- [ ] `src/domain.roles/behaver/skills/review.behavior.sh` implemented
- [ ] unit tests passing
- [ ] integration tests passing

### tasks

#### skill implementation
- [ ] 2.1: create `review.behavior.sh` with header comment block
- [ ] 2.2: implement argument parsing (--of, --against, --interactive, --dir)
- [ ] 2.3: implement behavior directory resolution from --of
- [ ] 2.4: implement artifact file resolution per --against targets
- [ ] 2.5: implement bhrain review invocation loop
- [ ] 2.6: implement feedback aggregation
- [ ] 2.7: implement logging to `.log/bhuild/review.behavior/`
- [ ] 2.8: implement spinner animation for non-interactive mode
- [ ] 2.9: implement tree-structured status output

#### unit tests
- [ ] 2.10: create `review.behavior.test.ts`
- [ ] 2.11: test: --of is required
- [ ] 2.12: test: behavior directory resolution finds correct match
- [ ] 2.13: test: ambiguous behavior name fails with clear error
- [ ] 2.14: test: absent behavior fails with clear error
- [ ] 2.15: test: artifact file resolution finds correct files
- [ ] 2.16: test: bhrain command is constructed correctly

#### integration tests
- [ ] 2.17: create `review.behavior.integration.test.ts`
- [ ] 2.18: create test assets under `.test/assets/example.repo/`
- [ ] 2.19: test: valid behavior produces feedback files
- [ ] 2.20: test: absent artifact warns but continues
- [ ] 2.21: test: --against subset only reviews specified artifacts

### acceptance criteria
```
given('phase.2 is complete')
  when('npm run test:unit -- review.behavior')
    then('all unit tests pass')
  when('npm run test:integration -- review.behavior')
    then('all integration tests pass')
  when('bash src/domain.roles/behaver/skills/review.behavior.sh --help')
    then('usage information is displayed')
```

### verification
```sh
npm run test:unit -- review.behavior
npm run test:integration -- review.behavior
bash src/domain.roles/behaver/skills/review.behavior.sh --of nonexistent 2>&1 | head -5
```

---

## phase.3 = symlinks + registration

### dependencies
- [x] phase.2 complete (skill and tests work)

### deliverables
- [ ] getBehaverRole.ts updated to include briefs directory
- [ ] briefs symlink resolves at `.agent/repo=bhuild/role=behaver/briefs/`

### tasks

- [ ] 3.1: update `src/domain.roles/behaver/getBehaverRole.ts` to export briefs path
- [ ] 3.2: create symlink at `.agent/repo=bhuild/role=behaver/briefs/briefs`
- [ ] 3.3: verify symlink resolves to `dist/domain.roles/behaver/briefs`
- [ ] 3.4: run `npm run build` to compile briefs to dist/

### acceptance criteria
```
given('phase.3 is complete')
  when('ls -la .agent/repo=bhuild/role=behaver/briefs/')
    then('briefs symlink exists and points to dist/')
  when('ls .agent/repo=bhuild/role=behaver/briefs/briefs/practices/')
    then('behavior.wish/, behavior.criteria/, behavior.blueprint/, behavior.roadmap/ are accessible')
  when('npx rhachet roles boot --repo bhuild --role behaver')
    then('briefs are loaded without error')
```

### verification
```sh
npm run build
ls -la .agent/repo=bhuild/role=behaver/briefs/
ls .agent/repo=bhuild/role=behaver/briefs/briefs/practices/
```

---

## phase.4 = validation

### dependencies
- [x] phase.3 complete (symlinks resolve, briefs accessible)

### deliverables
- [ ] review.behavior skill runs successfully against this behavior
- [ ] feedback file produced with accurate content

### tasks

- [ ] 4.1: run `npx rhachet run --repo bhuild --skill review.behavior --of review.behavior`
- [ ] 4.2: verify feedback file is created at expected location
- [ ] 4.3: review feedback content for accuracy
- [ ] 4.4: address any BLOCKERs found in self-review
- [ ] 4.5: document any known limitations or edge cases

### acceptance criteria
```
given('phase.4 is complete')
  when('npx rhachet run --repo bhuild --skill review.behavior --of review.behavior')
    then('command exits 0')
    then('feedback file exists at .behavior/v2025_12_23.review.behavior/7.2.review.behavior.[feedback].[given].by_robot.v*.md')
  when('cat feedback file')
    then('contains structured blocker/nitpick sections')
    then('references the rule briefs that were applied')
```

### verification
```sh
npx rhachet run --repo bhuild --skill review.behavior --of review.behavior
ls .behavior/v2025_12_23.review.behavior/7.2.review.behavior.*
cat .behavior/v2025_12_23.review.behavior/7.2.review.behavior.*.md | head -50
```

---

## summary

| phase | tasks | dependencies | key deliverable |
|-------|-------|--------------|-----------------|
| 0 | 16 | none | directory structure + scaffolded files |
| 1 | 12 | phase.0 | 12 rule briefs with full content |
| 2 | 21 | phase.1 | review.behavior.sh + passing tests |
| 3 | 4 | phase.2 | symlinks + registration |
| 4 | 5 | phase.3 | validated self-review |

total tasks: 58
