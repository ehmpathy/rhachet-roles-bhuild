# response checklist

## blocker.1: shift-enter does not newline
- [x] investigate terminal key detection for shift+return
  - shift+return often not detectable in terminals; added alternative key combo
- [x] add exitOnCtrlC: false to ink render options (required for ctrl key handler)
  - added to runFeedbackRepl.ts render() call
- [x] add alternative newline input: ctrl+j (traditional unix newline)
  - added ctrl+j handler in FeedbackRepl.tsx alongside shift+enter/alt+enter
  - updated header help text to show "ctrl+j" as primary with "(or shift+enter)"
- [x] test shift+enter and ctrl+j both work
  - all FeedbackRepl.input tests pass

## blocker.2: ctrl-c with input should clear, not exit
- [x] add exitOnCtrlC: false to render() call in runFeedbackRepl.ts
  - added as second argument to render()
- [x] verify ctrl+c clears input when input has content
  - FeedbackRepl.exit test [case1][t0] confirms this

## blocker.3: require 2 consecutive ctrl-c 500ms apart to exit
- [x] add state to track last ctrl-c timestamp
  - added exitPrompted state and lastCtrlCRef ref
- [x] implement 500ms window check for consecutive ctrl-c
  - ctrl-c handler now checks timeSinceLastCtrlC >= 500
- [x] show "press ctrl+c again to exit" message on first ctrl+c (when empty)
  - added conditional render of exit prompt hint
- [x] test double ctrl-c exit behavior
  - added 3 new tests: [t0] double ctrl+c exits, [t1] after feedback, [t2] too fast

## blocker.4: down arrow from history shows duplicate in terminal
- [x] investigate console.log outputs that create visual artifacts on navigation
  - no console.log in history navigation path; issue is ink not clear excess lines
- [x] ensure ink properly redraws when history navigation changes input
  - added useEffect to clear excess lines via ANSI escape codes when input shrinks
  - tracks prevLineCount and emits clear sequences for excess lines
- [x] test up/down history navigation renders cleanly
  - all FeedbackRepl.history tests pass (14 tests)

---

## additional feature: history navigation edits prior feedback entries

user requested: "when we go up, it should take us to the prior blocker number too"

- [x] change history storage from string[] to HistoryEntry[]
  - HistoryEntry = { text: string, severity: 'blocker' | 'nitpick', index: number }
  - updated countPriorFeedback to return entries with full context
- [x] add edit mode state to useFeedbackState
  - added inEditMode, currentIndex, nextNewIndex computed properties
  - navigateUp/Down now also set severity from history entry
- [x] update FeedbackRepl to show edit mode indicator
  - shows "[edit mode]" when in history navigation
  - shows correct index from history entry
- [x] update submit to handle edit vs new
  - onSubmit now receives isUpdate: boolean
  - handleSubmit updates history entry in place when in edit mode
- [x] update all tests for new HistoryEntry format
  - 53 FeedbackRepl tests pass

## issue: backspace halt when held
- [x] investigate rapid backspace key handler
  - issue: closure values for cursorPosition can become stale with rapid input
  - backspace handler used `cursorPosition` closure value directly
- [x] fix: use functional update in setCursorPosition
  - changed backspace and delete handlers to use `setCursorPosition((pos) => ...)`
  - ensures we work with latest position value, not stale closure
- [x] test continuous backspace behavior
  - all 53 FeedbackRepl tests pass

## output format improvements
- [x] add newline before beaver output
  - added `\n` before console.log in give.feedback.ts
- [x] add newline before feedback repl section
  - added blank line after separator in runFeedbackRepl.ts
- [x] show just filename instead of full path in beaver
  - changed computeFeedbackOutputTree to use `basename()` for filename
  - full path shown in prior feedback section below
  - updated 4 snapshots
