# research: oss levers for give.feedback tune

## summary

this research identifies open source tools to fulfill the blackbox criteria for:
1. output format tune (relative paths, tree-style display, editor open)
2. interactive repl mode (--talk with severity toggle, multiline input, history, undo)
3. realtime file mutation with change log

---

## 1. terminal ui frameworks

### 1.1 ink (react for cli)

**what**: react-based library for interactive cli apps

**maintenance**: active, used in production by major companies

**who uses it**:
- "many well-known tech giants like gatsby, github copilot, prisma, shopify, and others use ink to develop their cli tools" [1]
- "shopify cli - build apps, themes, and storefronts for the shopify platform" [1]
- "cloudflare's wrangler - the cli for cloudflare workers" [1]
- "terraform cdk - cloud development kit (cdk) for hashicorp terraform" [1]

**key features**:
- "ink has full typescript support. the library ships with type definitions" [2]
- "box works like a container of display: flex; on the web. you style it like a flexbox element" [3]
- "focus management - use the usefocus hook to manage focus between components" [3]
- "@inkjs/ui provides ready-made components (spinners, select inputs, progress bars)" [2]

**pros**:
- familiar react paradigm
- component composition
- built-in focus management for keyboard navigation
- rich ecosystem (@inkjs/ui)

**cons**:
- larger dependency footprint than raw readline
- react mental model required

**relevance**: high - ideal for --talk repl mode with severity toggle, multiline input

[1] https://github.com/vadimdemedes/ink
[2] https://news.ycombinator.com/item?id=42016639
[3] https://blog.logrocket.com/using-ink-ui-react-build-interactive-custom-clis/

---

### 1.2 @inquirer/prompts

**what**: collection of interactive cli prompts

**maintenance**: active, rewritten from ground up

**status**:
- "inquirer recently underwent a rewrite from the ground up to reduce the package size and improve performance" [4]
- "the legacy version (`inquirer`) still receives maintenance but is not actively developed. for the new inquirer, see `@inquirer/prompts`" [4]

**keyboard support**:
- "the user can use arrow up and arrow down keys to navigate the list of choices. `j` and `k` keyboard navigation is also available" [4]
- "for checkbox prompts: press `<space>` to select, `<a>` to toggle all, `<i>` to invert selection" [4]
- "when a user presses `ctrl+c` to exit a prompt, inquirer rejects the prompt promise" [4]

**pros**:
- battle-tested api
- built-in keyboard shortcuts
- promise-based

**cons**:
- predefined prompt types may limit custom repl behavior
- less flexible than raw readline for custom key binds

**relevance**: medium - good for simple prompts, but --talk needs more custom control

[4] https://github.com/SBoudrias/Inquirer.js

---

### 1.3 prompts (terkelg)

**what**: lightweight interactive prompts

**maintenance**: maintained, v2.4.2

**key features**:
- "lightweight, beautiful and user-friendly interactive prompts" [5]
- "no big dependencies nor is it broken into a dozen tiny modules" [5]
- "toggle/switch prompt: use tab or arrow keys/tab/space to switch between options" [5]
- dependencies: "kleur (^4.0.1) and sisteransi (^1.0.5)" [5]

**pros**:
- minimal dependencies
- toggle prompt built-in (good for severity switch)
- promise-based

**cons**:
- esm support still requested [5]
- less customizable than ink for complex ui

**relevance**: medium - toggle prompt useful for severity, but limited for full repl

[5] https://github.com/terkelg/prompts

---

## 2. dynamic prompt headers

### 2.1 readline setprompt (built-in)

**what**: dynamically update the prompt displayed to user

**how it works**:
- "setprompt() sets the prompt, for example when you run node on the command line, you see `>`, which is node's prompt" [21]
- "prompt() readies readline for input from the user, put the current setprompt options on a new line" [21]

**dynamic updates**:
- "you can use rl.setprompt(prefix, prefix.length) within the 'line' event handler to dynamically set the prompt after each line of input, then call rl.prompt() to display it" [21]

**usage for headers**:
```js
// update prompt when severity toggles
rl.setPrompt('# blocker.3 > ');
rl.prompt();

// after shift+tab toggle
rl.setPrompt('# nitpick.1 > ');
rl.prompt();
```

**relevance**: high - use for dynamic header display (# blocker.N > / # nitpick.N >)

[21] https://www.w3schools.com/nodejs/nodejs_readline.asp

---

## 3. multiline input patterns

### 3.1 ink-multiline-input (recommended for inline multiline)

**what**: multiline text input component for ink with configurable keybindings

**key features**:
- "vertical scroll that automatically scrolls to keep cursor in view" [26]
- "full cursor navigation support for arrow keys (up, down, left, right)" [26]
- "edit support for backspace and delete keys" [26]
- "customization to style the active line with highlightStyle" [26]

**keybindings for shift+enter / alt+enter**:
```jsx
keyBindings={{
  submit: (key) => key.return && !key.shift && !key.meta,  // enter alone to submit
  newline: (key) => (key.shift && key.return) || (key.meta && key.return),  // shift+enter or alt+enter for newline
}}
```

**full example**:
```jsx
import { MultilineInput } from "ink-multiline-input";

<MultilineInput
  value={value}
  onChange={setValue}
  rows={3}
  maxRows={10}
  placeholder="type feedback here..."
  onSubmit={(val) => submitFeedback(val)}
  keyBindings={{
    submit: (key) => key.return && !key.shift && !key.meta,
    newline: (key) => (key.shift && key.return) || (key.meta && key.return),
  }}
/>
```

**pros**:
- shift+enter and alt+enter configurable out of box
- inline multiline (no external editor context switch)
- cursor navigation built-in
- TypeScript support

**cons**:
- requires ink (react-based)
- newer package (v0.1.0 released jan 2026)

**relevance**: high - directly fulfills inline multiline with shift+enter/alt+enter requirement

[26] https://libraries.io/npm/ink-multiline-input

---

### 3.2 ctrl+d to submit (fallback pattern)

**what**: user types multiple lines, ctrl+d submits

**how node repl does it**:
- "the .editor command enables editor mode, which allows you to write multiline code with ease" [22]
- "once you are in this mode, enter ctrl+d to run the code you wrote" [22]
- "when you enter editor mode, the repl displays: '// enter editor mode (^D to finish, ^C to cancel)'" [22]

**key combos**:
- ctrl+d = submit/finish
- ctrl+c = cancel

**pros**:
- familiar pattern (node repl, many cli tools)
- simple to implement with readline raw mode
- no external deps

**cons**:
- requires user to know ctrl+d
- not inline multiline with shift+enter

**relevance**: medium - alternative if not via ink

[22] https://nodejs.org/en/learn/command-line/how-to-use-the-nodejs-repl

---

### 3.3 external editor ($EDITOR pattern)

**what**: spawn user's preferred editor for multiline input

**packages**:
- "@inquirer/external-editor receives 7,625,835 weekly downloads" [23]
- "this package is a replacement for the unmaintained external-editor and includes security fixes" [23]

**how it works**:
- "edit a string with the users preferred text editor via $VISUAL or $EDITOR" [23]
- "default editor is EDITOR or VISUAL environment variables, or 'notepad.exe' on windows, or 'vim' on unix" [23]

**usage**:
```js
import { edit } from '@inquirer/external-editor';
const data = edit('\n\n# Please write your text above');
```

**stdin consideration**:
- "all operations are synchronous to make sure the editor has complete control of the stdin and stdout" [24]
- "if you use readline or have other listeners on stdin, you will most likely have problems" [24]

**gh cli example**:
- "when run interactively, gh prompts you with 'Body [(e) to launch nano, enter to skip]'" [25]
- "press `e` will open your configured editor for multiline input" [25]

**pros**:
- user's familiar editor
- full edit capability (cursor movement, etc)
- good for longer feedback

**cons**:
- leaves terminal temporarily
- requires editor configured
- sync issues with readline

**relevance**: medium - good fallback for complex feedback, or as `e` hotkey option

[23] https://www.npmjs.com/package/@inquirer/external-editor
[24] https://www.npmjs.com/package/external-editor
[25] https://cli.github.com/manual/gh_pr_create

---

### 3.3 @inquirer/editor (higher-level)

**what**: prompt that opens editor with default content

**usage**:
```js
import { editor } from '@inquirer/prompts';
const answer = await editor({
  message: 'Enter a description',
});
```

**relevance**: medium - simpler api than raw external-editor

[23] https://www.npmjs.com/package/@inquirer/editor

---

### 3.4 double-enter / blank line pattern

**what**: two consecutive enters signals end of input

**observation**: common in modern cli tools but not well documented in npm ecosystem

**how to implement**:
- track if previous line was empty
- if current line also empty, submit accumulated lines
- otherwise, append line to buffer

**pros**:
- intuitive (like email compose)
- no special keys to learn

**cons**:
- can't have intentional blank lines in feedback
- need to show hint

**relevance**: medium - consider as alternative to ctrl+d

---

### 3.5 recommended multiline approach for --talk

**primary**: ctrl+d to submit pattern
- show hint in prompt: `# blocker.3 > (ctrl+d to submit, ctrl+c to cancel)`
- familiar to developers
- matches node repl behavior

**fallback**: `e` hotkey to open $EDITOR
- for longer/complex feedback
- like gh cli pattern

---

## 4. footer layout (status below input)

### 4.1 ink Box + Spacer pattern

**what**: ink's flexbox layout for input-above, status-below ui

**how it works**:
- "box works like a container of display: flex; on the web. you style it like a flexbox element" [3]
- "flexDirection property determines the direction in which child components are laid out: 'column' arranges vertically from top to bottom" [27]
- "spacer component that expands to fill available space, useful for layout" [27]

**footer layout example**:
```jsx
import { render, Box, Text, Spacer } from 'ink';
import { MultilineInput } from 'ink-multiline-input';

const FeedbackRepl = () => (
  <Box flexDirection="column" height={15}>
    {/* input area above */}
    <MultilineInput
      value={value}
      onChange={setValue}
      onSubmit={handleSubmit}
      keyBindings={{
        submit: (key) => key.return && !key.shift && !key.meta,
        newline: (key) => (key.shift && key.return) || (key.meta && key.return),
      }}
    />

    {/* spacer pushes footer to bottom */}
    <Spacer />

    {/* footer below (like claude code) */}
    <Box>
      <Text color="cyan"># blocker.3 &gt;</Text>
      <Text dimColor> (shift+tab to toggle severity)</Text>
    </Box>
  </Box>
);
```

**why ink for footer**:
- raw readline only supports prompts *before* input, not *after*
- ink's flexbox enables true footer layout with input above, status below
- matches claude code's ux pattern

**relevance**: high - only viable approach for footer below input

[27] https://vadimdemedes.com/posts/ink-react-cli-layouts

---

## 5. keyboard/input handler

### 5.1 node.js readline (built-in)

**what**: built-in module for line-by-line input

**key features**:
- "readline.emitkeypressevents() method causes the given readable stream to begin emitter of 'keypress' events" [6]
- "the key object yields information about the key sequence: ctrl, meta, shift booleans" [6]
- "instances of repl.replserver support automatic completion, completion preview, emacs-style line edit, multi-line inputs, zsh-like reverse-i-search, zsh-like substring-based history search" [7]

**raw mode**:
- "if the stream is a tty, then it must be in raw mode" [6]
- "raw mode removes standard keypress events and other functionality node.js adds by default" [8]

**multiline history (recent)**:
- "a recent pr improves the repl history behavior via treatment of multiline commands as a single entry" [7]
- "now, when the user scrolls through history, entire blocks of multiline input are displayed together" [7]

**custom prompts**:
- "the default prompt is '> ' (with a space after), but we can define custom prompt" [7]
- "when multi-line input is entered, a pipe '|' is printed rather than the 'prompt'" [7]

**pros**:
- zero dependencies (built-in)
- full control over key events
- shift+tab detectable via key.shift + key.name === 'tab'

**cons**:
- low-level api requires more code
- ui render is manual

**relevance**: high - foundation for custom repl with shift+tab severity toggle

[6] https://nodejs.org/api/readline.html
[7] https://nodejs.org/api/repl.html
[8] https://thisdavej.com/making-interactive-node-js-console-apps-that-listen-for-keypress-events/

---

### 4.2 keypress (npm)

**what**: make any readable stream emit keypress events

**key features**:
- "make any node readablestream emit 'keypress' events" [9]

**note**:
- "in node v0.8.x and later, the 'keypress' event does not get emitted by default, but rather only when used in conjunction with the readline module" [6]

**relevance**: low - readline.emitkeypressevents() is preferred (built-in)

[9] https://github.com/TooTallNate/keypress

---

## 5. file/editor opener

### 5.1 open (sindresorhus)

**what**: open urls, files, executables cross-platform

**how it works**:
- "uses the command `open` on macos, `start` on windows and `xdg-open` on other platforms" [10]

**usage**:
- "await open('unicorn.png', {wait: true})" [10]
- "await open('https://sindresorhus.com', {app: {name: 'firefox'}})" [10]
- "await open(url, {app: {name: 'google chrome', arguments: ['--incognito']}})" [10]

**pros**:
- cross-platform
- app specification supported
- widely used

**relevance**: high - use for --open codium

[10] https://github.com/sindresorhus/open

---

### 5.2 open-editor (sindresorhus)

**what**: open files in editor at specific line/column

**editors supported**:
- "vscode, webstorm, textmate, vim, neovim, intellij, emacs, and nano" [11]

**relevance**: high - better than raw `open` for editor-specific features

[11] https://www.npmjs.com/package/open-editor

---

### 5.3 launch-ide

**what**: auto-detect and launch ide

**key feature**:
- "automatically recognize the editor via run process detection and open the specified file in it" [12]
- "compatible with windows, macos and linux" [12]
- "supports multiple editors such as vscode, cursor, windsurf, webstorm, etc" [12]

**relevance**: medium - auto-detection useful but explicit --open codium is clearer

[12] https://www.npmjs.com/package/launch-ide

---

## 7. terminal colors

### 7.1 picocolors

**what**: tiny terminal color library

**performance**:
- "picocolors is 14 times smaller and 2 times faster than chalk" [13]
- "space in node_modules: chalk 101 kb, picocolors 7 kb" [13]
- "load time: chalk 6.167 ms, picocolors 0.466 ms" [13]

**adoption**:
- "used by popular tools like postcss, svgo, stylelint, and browserslist" [13]

**limitation**:
- "picocolors doesn't handle multi-line text style breaks" [13]
- "only chalk and ansis support truecolor" [13]

**relevance**: high - ideal for simple color needs (severity indicators)

[13] https://dev.to/webdiscus/comparison-of-nodejs-libraries-to-colorize-text-in-terminal-4j3a

---

### 7.2 chalk

**what**: terminal string style

**features**:
- "chalk supports 256 colors and truecolor (16 million colors)" [13]
- "well-documented types, supports millions of colors, and covers edge cases" [13]

**maintainer note**:
- "micro-benchmarks are flawed. all the color packages are more than fast enough" [13]

**relevance**: medium - overkill for simple blocker/nitpick indicators

[13] https://dev.to/webdiscus/comparison-of-nodejs-libraries-to-colorize-text-in-terminal-4j3a

---

## 8. unicode symbols

### 8.1 figures (sindresorhus)

**what**: unicode symbols with terminal fallbacks

**how it works**:
- "terminals such as windows console host (and cmd) only support a limited character set" [14]
- "provides symbols to use on any terminal (default export), mainsymbols for unicode terminals, fallbacksymbols for limited terminals" [14]

**usage**:
- "console.log(figures.tick); // on unicode terminals: âœ”, on others: âˆš" [14]

**stats**: ~35 million weekly downloads [14]

**relevance**: high - use for tree display (â”œâ”€, â””â”€) and status symbols

[14] https://github.com/sindresorhus/figures

---

### 8.2 log-symbols

**what**: colored symbols for log levels

**relevance**: medium - figures is more general

[14] https://www.npmjs.com/package/log-symbols

---

## 9. tree display

### 9.1 treeify

**what**: convert js object to tree string

**how it works**:
- "converts a js object into a nice, visible depth-indented tree for console print" [15]
- "structure generated is similar to what you get via the tree command on unixy platforms" [15]

**relevance**: high - ideal for output format (ðŸ¦« wassup? â”œâ”€ path â””â”€ action)

[15] https://www.npmjs.com/package/treeify

---

### 9.2 tree-node-cli

**what**: directory tree as string

**usage**:
- "can be used programmatically: const tree = require('tree-node-cli'); const string = tree('path/to/dir', options);" [16]

**relevance**: low - for directory trees, not custom object trees

[16] https://github.com/yangshun/tree-node-cli

---

## 10. spinners

### 10.1 nanospinner

**what**: tiny terminal spinner

**size**:
- "15 times smaller than ora" [17]
- "space in node_modules: ora 280 kb, nanospinner 20 kb" [17]
- "only single dependency (picocolors)" [17]

**philosophy**:
- "with nanospinner we want to draw attention to the node_modules size problem" [17]

**relevance**: low - no spinner needed for give.feedback

[17] https://github.com/usmanyunusov/nanospinner

---

## 11. file operations

### 11.1 fs.appendfile (built-in)

**what**: append data to file

**behavior**:
- "adds content to the end of files without overwrite of prior data" [18]
- "works asynchronously, so it doesn't block other operations" [18]

**atomicity**:
- "if you do append writes it is always atomic" [19]

**relevance**: high - use for append of feedback blocks and jsonl change log

[18] https://www.geeksforgeeks.org/node-js/node-js-fs-appendfile-function/
[19] https://groups.google.com/g/nodejs/c/sPPM8Y7v6BY

---

### 11.2 write-file-atomic

**what**: atomic file writes

**how it works**:
- "file is initially named filename + '.' + murmurhex(__filename, process.pid, ++invocations). finally it renames the file back to the filename" [20]

**relevance**: medium - useful for feedback file upserts, but append is simpler for jsonl

[20] https://github.com/npm/write-file-atomic

---

## 12. recommended stack

based on the research, recommended tools for each criterion:

| criterion | recommended tool | rationale |
|-----------|------------------|-----------|
| output tree format | **figures** + manual string | simple, cross-platform unicode |
| editor open | **open-editor** | editor-specific, line support |
| repl ui | **ink** | required for footer layout |
| inline multiline | **ink-multiline-input** | shift+enter/alt+enter configurable |
| footer layout | **ink Box + Spacer** | input above, status below |
| severity toggle | **ink useInput** | shift+tab detection |
| history navigation | **ink state** | store in react state |
| colors | **picocolors** | tiny, fast, sufficient |
| file append | **fs.appendfile** | built-in, atomic for appends |
| change log | **fs.appendfile** | jsonl append is atomic |

---

## 13. decision matrix

### option a: minimal (readline + fs)

**deps**: 3 (open-editor, picocolors, figures)

**pros**:
- minimal footprint
- full control
- no react overhead

**cons**:
- cannot do footer below input (prompts are above)
- cannot do inline multiline with shift+enter (complex raw mode handling)
- manual state management

**verdict**: insufficient for requirements

### option b: ink-based (recommended)

**deps**: ~8 (ink, ink-multiline-input, open-editor, picocolors, figures, react, react-reconciler, yoga-wasm-web)

**pros**:
- footer layout via Box + Spacer
- inline multiline via ink-multiline-input
- shift+enter/alt+enter configurable
- declarative state
- focus management built-in

**cons**:
- react dependency
- larger bundle

**verdict**: required for footer + inline multiline requirements

### recommendation

**option b (ink-based)** for give.feedback because:
1. footer below input requires ink's flexbox layout (readline cannot)
2. inline multiline with shift+enter requires ink-multiline-input
3. ink-multiline-input provides configurable keybindings for shift+enter and alt+enter
4. react pattern enables clean state management for undo/redo

---

## citations

[1] https://github.com/vadimdemedes/ink
[2] https://news.ycombinator.com/item?id=42016639
[3] https://blog.logrocket.com/using-ink-ui-react-build-interactive-custom-clis/
[4] https://github.com/SBoudrias/Inquirer.js
[5] https://github.com/terkelg/prompts
[6] https://nodejs.org/api/readline.html
[7] https://nodejs.org/api/repl.html
[8] https://thisdavej.com/making-interactive-node-js-console-apps-that-listen-for-keypress-events/
[9] https://github.com/TooTallNate/keypress
[10] https://github.com/sindresorhus/open
[11] https://www.npmjs.com/package/open-editor
[12] https://www.npmjs.com/package/launch-ide
[13] https://dev.to/webdiscus/comparison-of-nodejs-libraries-to-colorize-text-in-terminal-4j3a
[14] https://github.com/sindresorhus/figures
[15] https://www.npmjs.com/package/treeify
[16] https://github.com/yangshun/tree-node-cli
[17] https://github.com/usmanyunusov/nanospinner
[18] https://www.geeksforgeeks.org/node-js/node-js-fs-appendfile-function/
[19] https://groups.google.com/g/nodejs/c/sPPM8Y7v6BY
[20] https://github.com/npm/write-file-atomic
[21] https://www.w3schools.com/nodejs/nodejs_readline.asp
[22] https://nodejs.org/en/learn/command-line/how-to-use-the-nodejs-repl
[23] https://www.npmjs.com/package/@inquirer/external-editor
[24] https://www.npmjs.com/package/external-editor
[25] https://cli.github.com/manual/gh_pr_create
[26] https://libraries.io/npm/ink-multiline-input
[27] https://vadimdemedes.com/posts/ink-react-cli-layouts
