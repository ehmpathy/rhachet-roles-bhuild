# execution: give.feedback tune (v1)

## progress tracker

started: 2026-01-17

---

## phase 0: open mode tune

### step 0.1: change giveFeedback to findsert semantics

- [x] modify `giveFeedback.ts` to return `{ found: true }` instead of throw
- [x] update tests to expect findsert behavior
- [x] verify: `npm run test:unit -- giveFeedback.test.ts`

**status**: âœ… done

---

### step 0.2: add computeFeedbackOutputTree for tree output

- [x] create `computeFeedbackOutputTree.ts`
- [x] create `computeFeedbackOutputTree.test.ts`
- [x] verify: `npm run test:unit -- computeFeedbackOutputTree.test.ts`

**status**: âœ… done

---

### step 0.3: add --open flag support

- [x] extend `giveFeedback.ts` for --open
- [x] extend `give.feedback.ts` cli for --open
- [x] extend `give.feedback.sh` to pass --open
- [x] verify: `npm run test:integration -- giveFeedback.integration.test.ts`

**status**: âœ… done

---

### step 0.4: add --version tip for findsert case

- [x] update `computeFeedbackOutputTree.ts` to include --version tip
- [x] verify: `npm run test:unit -- computeFeedbackOutputTree.test.ts`

**status**: âœ… done

---

### step 0.5: integration test for open mode

- [x] update `giveFeedback.integration.test.ts` for findsert + tree output
- [x] verify: `npm run test:integration -- giveFeedback.integration.test.ts`

**status**: âœ… done

---

### phase 0 checkpoint

- [x] `npm run test:unit -- giveFeedback` â†’ 8 passed
- [x] `npm run test:unit -- computeFeedbackOutputTree` â†’ 9 passed (4 snapshots)
- [x] `npm run test:integration -- giveFeedback` â†’ 8 passed

**status**: âœ… done

---

## phase 1: repl mode core

### step 1.1: add useFeedbackState hook

- [x] create `useFeedbackState.ts`
- [x] create `useFeedbackState.test.ts`
- [x] verify: `npm run test:unit -- useFeedbackState.test.ts` â†’ 8 passed

**status**: âœ… done

---

### step 1.2: add FeedbackRepl component scaffold

- [x] create `FeedbackRepl.tsx`
- [x] create `FeedbackRepl.test.ts`
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 6 passed

**status**: âœ… done

---

### step 1.3: add shift+tab severity toggle

- [x] verify shift+tab toggles severity in FeedbackRepl
- [x] add test for severity toggle behavior
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 13 passed

**status**: âœ… done

---

### step 1.4: add multiline input support

- [x] verify shift+enter adds newline
- [x] add test for multiline behavior
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 13 passed

**status**: âœ… done

---

### step 1.5: add computeFeedbackBlockContent

- [x] create `computeFeedbackBlockContent.ts`
- [x] create `computeFeedbackBlockContent.test.ts`
- [x] verify: `npm run test:unit -- computeFeedbackBlockContent.test.ts` â†’ 7 passed (2 snapshots)

**status**: âœ… done

---

### step 1.6: add file mutation on submit

- [x] create `appendFeedbackToFile.ts`
- [x] create `appendFeedbackToFile.test.ts`
- [x] verify: `npm run test:unit -- appendFeedbackToFile.test.ts` â†’ 3 passed

**status**: âœ… done

---

### step 1.7: add --talk flag to skill

- [x] extend `give.feedback.ts` cli for --talk
- [x] extend `give.feedback.sh` to pass --talk
- [x] verify: `npm run test:integration -- giveFeedback` â†’ 8 passed

**status**: âœ… done

---

### step 1.8: add ctrl+c exit behavior

- [x] verify ctrl+c clears input or exits
- [x] add test for exit behavior
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 13 passed

**status**: âœ… done

---

### step 1.9: verify FeedbackRepl tests adhere to blueprint

- [x] install ink-testing-library@3 for ink v3.2.0
- [x] rewrite FeedbackRepl.test.ts with render/lastFrame assertions
- [x] add snapshot tests for initial render and post-toggle states
- [x] verify all phase 1 test cases per blueprint (lines 526-544)
- [x] add brief: `.agent/repo=.this/role=any/briefs/howto.test-ink-components.[lesson].md`
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 18 passed (4 snapshots)

**status**: âœ… done

---

### phase 1 checkpoint

- [x] `npm run test:unit -- repl/` â†’ 84 passed (6 snapshots)
- [x] `npm run test:integration -- giveFeedback` â†’ 8 passed
- [x] FeedbackRepl tests verified against blueprint test cases

**status**: âœ… done

---

## phase 2: repl mode undo/redo

### step 2.1: wire undo/redo keybindings

- [x] add onUndo/onRedo callback props to FeedbackRepl.tsx
- [x] wire ctrl+z to call onUndo
- [x] wire ctrl+y to call onRedo
- [x] update runFeedbackRepl.ts with undo/redo handlers
- [x] add tests for ctrl+z/ctrl+y in FeedbackRepl.test.ts
- [x] verify: `npm run test:unit -- FeedbackRepl.test.ts` â†’ 20 passed

**status**: âœ… done

---

### phase 2 checkpoint

- [x] `npm run test:unit -- repl/` â†’ 86 passed (4 snapshots)
- [x] ctrl+z undo wired and tested
- [x] ctrl+y redo wired and tested

**status**: âœ… done

---

## phase 3: repl UI improvements

### step 3.1: add bordered header with file path and counts

- [ ] add ink-box@2.0.0 dependency for border support
- [ ] update FeedbackRepl to accept feedbackFile prop
- [ ] add bordered header showing file being edited
- [ ] add blocker/nitpick counters (red/yellow unicode circles in treestruct)
- [ ] re-render header after each submission with updated counts
- [ ] update FeedbackRepl.test.ts with new header tests
- [ ] verify: `npm run test:unit -- FeedbackRepl.test.ts`

**status**: ğŸ”„ in progress

---

### step 3.2: add integration tests with snapshots for file mutations

- [ ] add integration test for append (new feedback)
- [ ] add integration test for update (replace existing feedback)
- [ ] add integration test for undo
- [ ] add integration test for redo
- [ ] add snapshots demonstrating file content at each stage
- [ ] verify: `npm run test:integration -- appendFeedbackToFile`

**status**: â³ pending

---

### phase 3 checkpoint

- [ ] `npm run test:unit -- FeedbackRepl` â†’ all pass
- [ ] `npm run test:integration -- appendFeedbackToFile` â†’ all pass with snapshots
- [ ] bordered header displays correctly
- [ ] counts update after each submission

**status**: â³ pending

---

## changelog

| date | step | action |
|------|------|--------|
| 2026-01-17 | 0.1 | started execution |
| 2026-01-17 | 0.1 | done: findsert semantics |
| 2026-01-17 | 0.2 | done: computeFeedbackOutputTree |
| 2026-01-17 | 0.3 | done: --open flag support |
| 2026-01-17 | 0.4 | done: --version tip |
| 2026-01-17 | 0.5 | done: integration tests |
| 2026-01-17 | phase 0 | âœ… complete |
| 2026-01-17 | 1.x | started phase 1: repl mode core |
| 2026-01-17 | 1.1 | done: useFeedbackState hook (8 tests) |
| 2026-01-17 | 1.2 | done: FeedbackRepl scaffold (6 tests) |
| 2026-01-17 | 1.3 | done: shift+tab severity toggle |
| 2026-01-17 | 1.4 | done: multiline input support |
| 2026-01-17 | 1.8 | done: ctrl+c exit behavior (13 tests total) |
| 2026-01-17 | 1.5 | done: computeFeedbackBlockContent (7 tests, 2 snaps) |
| 2026-01-17 | 1.6 | done: appendFeedbackToFile (3 tests) |
| 2026-01-17 | 1.7 | done: --talk flag to skill (already implemented) |
| 2026-01-18 | 1.9 | done: FeedbackRepl tests rewritten per blueprint (18 tests, 4 snaps) |
| 2026-01-18 | 1.9 | added brief: howto.test-ink-components.[lesson].md |
| 2026-01-18 | 1.9 | added utility: src/.test/infra/emitInkStdin.ts |
| 2026-01-18 | phase 1 | âœ… complete (84 unit + 8 integration tests) |
| 2026-01-18 | 2.1 | done: wire ctrl+z/ctrl+y for undo/redo |
| 2026-01-18 | phase 2 | âœ… complete (86 unit tests) |
| 2026-01-18 | 3.x | started phase 3: repl UI improvements |
