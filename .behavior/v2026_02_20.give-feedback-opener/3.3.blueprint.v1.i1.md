# blueprint: give-feedback-opener

## overview

extend `give.feedback` skill to:
1. output tree-style format with `ğŸ¦« wassup?` header
2. default to latest feedback version (findsert behavior)
3. support `--version ++` to increment
4. support `--open <editor>` to auto-open

## filediffs

```
src/
â”œâ”€â”€ contract/
â”‚   â””â”€â”€ cli/
â”‚       â””â”€â”€ [~] give.feedback.ts              # add --open, new output format
â”‚
â”œâ”€â”€ domain.operations/
â”‚   â””â”€â”€ behavior/
â”‚       â”œâ”€â”€ feedback/
â”‚       â”‚   â”œâ”€â”€ [~] giveFeedback.ts           # findsert, latest default, ++ support
â”‚       â”‚   â”œâ”€â”€ [~] giveFeedback.test.ts      # add findsert, latest, ++ tests
â”‚       â”‚   â”œâ”€â”€ [~] giveFeedback.integration.test.ts  # update duplicate â†’ findsert
â”‚       â”‚   â”œâ”€â”€ [+] getLatestFeedbackVersion.ts       # find highest feedback version
â”‚       â”‚   â””â”€â”€ [+] getLatestFeedbackVersion.test.ts
â”‚       â”‚
â”‚       â””â”€â”€ render/
â”‚           â”œâ”€â”€ [+] computeFeedbackOutput.ts          # ğŸ¦« wassup? tree format
â”‚           â””â”€â”€ [+] computeFeedbackOutput.test.ts
â”‚
â””â”€â”€ domain.roles/
    â””â”€â”€ behaver/
        â””â”€â”€ skills/
            â””â”€â”€ [~] give.feedback.sh          # add --open to docs
```

## codepaths

### contract layer

```
give.feedback CLI
â”œâ”€â”€ [~] schemaOfArgs
â”‚   â”œâ”€â”€ [â—‹] against: z.string()
â”‚   â”œâ”€â”€ [â—‹] behavior: z.string().optional()
â”‚   â”œâ”€â”€ [~] version: z.union([z.coerce.number(), z.literal('++')]).optional()
â”‚   â”œâ”€â”€ [â—‹] template: z.string().optional()
â”‚   â”œâ”€â”€ [â—‹] force: z.boolean().optional()
â”‚   â””â”€â”€ [+] open: z.string().optional()
â”‚
â”œâ”€â”€ [+] validate --open not empty (reuse from init.behavior)
â”‚
â”œâ”€â”€ [~] call giveFeedbackOp
â”‚   â””â”€â”€ pass version as number | '++' | undefined
â”‚
â”œâ”€â”€ [+] call openFileWithOpener if --open provided
â”‚   â””â”€â”€ [â†] reuse OpenerUnavailableError handle from init.behavior
â”‚
â””â”€â”€ [~] stdout
    â””â”€â”€ [+] call computeFeedbackOutput (replaces inline console.log)
```

### domain.operations layer

```
giveFeedback
â”œâ”€â”€ [â—‹] resolve behavior directory (getBehaviorDirForFeedback)
â”œâ”€â”€ [â—‹] find latest artifact (getLatestArtifactByName)
â”‚
â”œâ”€â”€ [~] resolve feedback version
â”‚   â”œâ”€â”€ [+] if version undefined â†’ call getLatestFeedbackVersion â†’ use latest or 1
â”‚   â”œâ”€â”€ [+] if version === '++' â†’ call getLatestFeedbackVersion â†’ use latest + 1
â”‚   â””â”€â”€ [â—‹] if version is number â†’ use as-is
â”‚
â”œâ”€â”€ [â—‹] compute feedback filename (computeBehaviorFeedbackName)
â”‚
â”œâ”€â”€ [~] check if feedback file exists
â”‚   â”œâ”€â”€ [-] throw BadRequestError (remove)
â”‚   â””â”€â”€ [+] return { feedbackFile, artifactFile, behaviorDir, created: false }
â”‚
â”œâ”€â”€ [â—‹] resolve template path
â”œâ”€â”€ [â—‹] init feedback file from template (initFeedbackTemplate)
â”‚
â””â”€â”€ [~] return
    â””â”€â”€ [+] add created: true to result
```

```
getLatestFeedbackVersion [+]
â”œâ”€â”€ read behavior directory
â”œâ”€â”€ filter files that match [feedback].v{N} pattern for artifact
â”œâ”€â”€ parse version numbers
â”œâ”€â”€ sort desc
â””â”€â”€ return highest version or null
```

```
computeFeedbackOutput [+]
â”œâ”€â”€ input: { feedbackFilename, created, opener? }
â”œâ”€â”€ line 1: "ğŸ¦« wassup?"
â”œâ”€â”€ line 2: "   â”œâ”€ âœ“ {feedbackFilename}"
â”œâ”€â”€ line 3: "   â”œâ”€ tip: use --version ++ to create a new version"
â”œâ”€â”€ line 4a (if opener): "   â””â”€ opened in {opener}"
â””â”€â”€ line 4b (no opener): "   â””â”€ tip: use --open nvim to open automatically"
```

## test coverage

### unit tests

```
giveFeedback.test.ts
â”œâ”€â”€ [â—‹] creates feedback for execution artifact
â”œâ”€â”€ [â—‹] creates feedback for criteria.blackbox
â”œâ”€â”€ [â—‹] creates feedback for wish
â”œâ”€â”€ [â—‹] respects --version flag (number)
â”œâ”€â”€ [â—‹] uses custom --template
â”œâ”€â”€ [â—‹] fails if artifact not found
â”œâ”€â”€ [-] fails if feedback file already present â†’ remove
â”œâ”€â”€ [+] findsert: returns found when feedback v1 exists
â”œâ”€â”€ [+] defaults to latest version when v1 exists
â”œâ”€â”€ [+] defaults to latest version when v1+v2 exist
â”œâ”€â”€ [+] version ++ creates v2 when v1 exists
â”œâ”€â”€ [+] version ++ creates v3 when v1+v2 exist
â”œâ”€â”€ [+] version ++ creates v1 when none exist
â””â”€â”€ [â—‹] fails if template not found
```

```
getLatestFeedbackVersion.test.ts [+]
â”œâ”€â”€ returns null when no feedback exists
â”œâ”€â”€ returns 1 when v1 exists
â”œâ”€â”€ returns 2 when v1+v2 exist
â”œâ”€â”€ returns highest version regardless of order
â””â”€â”€ ignores feedback for other artifacts
```

```
computeFeedbackOutput.test.ts [+]
â”œâ”€â”€ line 1 is "ğŸ¦« wassup?"
â”œâ”€â”€ line 2 contains âœ“ and filename
â”œâ”€â”€ line 3 contains --version ++ tip
â”œâ”€â”€ with opener: line 4 shows "opened in {opener}"
â”œâ”€â”€ without opener: line 4 shows --open tip
â””â”€â”€ uses â””â”€ for last line, â”œâ”€ for others
```

### integration tests

```
giveFeedback.integration.test.ts
â”œâ”€â”€ [~] [case1] behavior with execution artifact
â”‚   â”œâ”€â”€ [â—‹] [t0] creates feedback with placeholders replaced
â”‚   â”œâ”€â”€ [~] [t1] second call returns found (not throws)
â”‚   â””â”€â”€ [â—‹] [t2] --version 2 creates v2
â”‚
â”œâ”€â”€ [â—‹] [case2] behavior with multiple artifact versions
â”œâ”€â”€ [â—‹] [case3] behavior without template
â”œâ”€â”€ [â—‹] [case4] behavior with custom template path
â”‚
â”œâ”€â”€ [+] [case5] feedback v1 already exists
â”‚   â”œâ”€â”€ [t0] call without --version returns v1
â”‚   â””â”€â”€ [t1] call with --version ++ creates v2
â”‚
â””â”€â”€ [+] [case6] feedback v1+v2 already exist
    â”œâ”€â”€ [t0] call without --version returns v2 (latest)
    â””â”€â”€ [t1] call with --version ++ creates v3
```

## contracts

### giveFeedback input change

```typescript
// before
input: {
  against: string;
  behavior?: string;
  version?: number;
  template?: string;
  force?: boolean;
}

// after
input: {
  against: string;
  behavior?: string;
  version?: number | '++';  // changed: support ++
  template?: string;
  force?: boolean;
}
```

### giveFeedback output change

```typescript
// before
{ feedbackFile: string; artifactFile: string; behaviorDir: string }

// after
{ feedbackFile: string; artifactFile: string; behaviorDir: string; created: boolean }
```

### CLI schema change

```typescript
// before
version: z.coerce.number().optional()

// after
version: z.union([z.coerce.number(), z.literal('++')]).optional()
```

## execution order

1. **getLatestFeedbackVersion** â€” new helper, no dependencies
2. **getLatestFeedbackVersion.test.ts** â€” prove helper works
3. **giveFeedback** â€” update to use helper, findsert, ++
4. **giveFeedback.test.ts** â€” update tests for new behavior
5. **computeFeedbackOutput** â€” new render function
6. **computeFeedbackOutput.test.ts** â€” prove output format
7. **give.feedback CLI** â€” wire up --open, new output
8. **giveFeedback.integration.test.ts** â€” add findsert cases
9. **give.feedback.sh** â€” update docs for --open
