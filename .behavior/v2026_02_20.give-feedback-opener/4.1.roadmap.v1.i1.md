# roadmap: give-feedback-opener

## phase 0: setup

### read before
- `.behavior/v2026_02_20.give-feedback-opener/3.3.blueprint.v1.i1.md`

### tasks
- [ ] 0.1 verify build passes: `npm run build`
- [ ] 0.2 verify tests pass: `npm run test`

### accept
- [ ] clean baseline confirmed

---

## phase 1: getLatestFeedbackVersion helper

### read before
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.prod.v1.i1.md` (pattern.7 version parse)
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.test.v1.i1.md` (pattern.5 version detection tests)

### tasks
- [ ] 1.1 create `src/domain.operations/behavior/feedback/getLatestFeedbackVersion.ts`
- [ ] 1.2 create `src/domain.operations/behavior/feedback/getLatestFeedbackVersion.test.ts`

### accept
- [ ] `npm run test:unit -- getLatestFeedbackVersion` passes
- [ ] returns null when no feedback exists
- [ ] returns highest version when multiple exist

---

## phase 2: giveFeedback findsert + latest + ++

### read before
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.prod.v1.i1.md` (pattern.1 giveFeedback)
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.test.v1.i1.md` (pattern.1-2 test structure)

### depends on
- phase 1 (getLatestFeedbackVersion)

### tasks
- [ ] 2.1 update `giveFeedback.ts` input type: `version?: number | '++'`
- [ ] 2.2 update `giveFeedback.ts` to call getLatestFeedbackVersion when version undefined
- [ ] 2.3 update `giveFeedback.ts` to handle `++` â†’ latest + 1
- [ ] 2.4 update `giveFeedback.ts` to findsert (return found, not throw)
- [ ] 2.5 update `giveFeedback.ts` output: add `created: boolean`
- [ ] 2.6 update `giveFeedback.test.ts`: remove "fails if already present" test
- [ ] 2.7 update `giveFeedback.test.ts`: add findsert test
- [ ] 2.8 update `giveFeedback.test.ts`: add latest default tests
- [ ] 2.9 update `giveFeedback.test.ts`: add ++ tests

### accept
- [ ] `npm run test:unit -- giveFeedback` passes
- [ ] findsert: second call returns found without error
- [ ] default opens latest when v1 exists
- [ ] `++` creates next version

---

## phase 3: computeFeedbackOutput render

### read before
- `.behavior/v2026_02_20.give-feedback-opener/1.vision.md` (output format examples)
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.prod.v1.i1.md` (pattern.4 computeFooterOutput)
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.test.v1.i1.md` (pattern.3 output line tests)

### tasks
- [ ] 3.1 create `src/domain.operations/behavior/render/computeFeedbackOutput.ts`
- [ ] 3.2 create `src/domain.operations/behavior/render/computeFeedbackOutput.test.ts`

### accept
- [ ] `npm run test:unit -- computeFeedbackOutput` passes
- [ ] line 1 is `ðŸ¦« wassup?`
- [ ] line 2 contains `âœ“` and filename
- [ ] line 3 contains `--version ++` tip
- [ ] line 4 shows opener or opener tip

---

## phase 4: give.feedback CLI --open + output

### read before
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.prod.v1.i1.md` (pattern.3 init.behavior --open)
- `.behavior/v2026_02_20.give-feedback-opener/2.1.criteria.blackbox.md` (usecase.5-9)

### depends on
- phase 2 (giveFeedback findsert)
- phase 3 (computeFeedbackOutput)

### tasks
- [ ] 4.1 update CLI schema: add `open: z.string().optional()`
- [ ] 4.2 update CLI schema: `version: z.union([z.coerce.number(), z.literal('++')]).optional()`
- [ ] 4.3 add --open empty validation (copy from init.behavior)
- [ ] 4.4 add openFileWithOpener call with OpenerUnavailableError handle
- [ ] 4.5 replace console.log with computeFeedbackOutput call
- [ ] 4.6 pass relative filename (not full path) to output

### accept
- [ ] `npm run build` passes
- [ ] manual test: `npx rhachet run --skill give.feedback --against wish` shows `ðŸ¦« wassup?`
- [ ] manual test: output shows relative filename only
- [ ] manual test: `--open codium` opens file

---

## phase 5: integration tests

### read before
- `.behavior/v2026_02_20.give-feedback-opener/3.1.research.patterns._.code.test.v1.i1.md` (pattern.2 BDD structure)
- `.behavior/v2026_02_20.give-feedback-opener/2.1.criteria.blackbox.md` (all usecases)

### depends on
- phase 4 (CLI complete)

### tasks
- [ ] 5.1 update `[case1] [t1]` to expect findsert (not throw)
- [ ] 5.2 add `[case5]` feedback v1 already exists
- [ ] 5.3 add `[case6]` feedback v1+v2 already exist

### accept
- [ ] `npm run test:integration -- giveFeedback` passes
- [ ] findsert behavior verified end-to-end
- [ ] latest version behavior verified
- [ ] `++` increment behavior verified

---

## phase 6: docs + cleanup

### depends on
- phase 5 (all tests pass)

### tasks
- [ ] 6.1 update `give.feedback.sh` header: add --open to usage
- [ ] 6.2 update `give.feedback.sh` header: document --version ++
- [ ] 6.3 verify all tests pass: `npm run test`
- [ ] 6.4 verify build passes: `npm run build`

### accept
- [ ] `npm run test` passes
- [ ] `npm run build` passes
- [ ] skill docs reflect new --open and --version ++ options

---

## final verification

### read before
- `.behavior/v2026_02_20.give-feedback-opener/2.1.criteria.blackbox.md`
- `.behavior/v2026_02_20.give-feedback-opener/2.2.criteria.blackbox.matrix.md`

### accept (from blackbox criteria)
- [ ] usecase.1: create feedback when none exists â†’ creates v1
- [ ] usecase.2: open latest feedback when it exists â†’ opens latest
- [ ] usecase.3: `--version ++` â†’ creates next version
- [ ] usecase.4: `--version N` â†’ opens specific version
- [ ] usecase.5: `--open <editor>` â†’ opens in editor
- [ ] usecase.6: no `--open` â†’ shows tip
- [ ] usecase.7: output format â†’ `ðŸ¦« wassup?`, relative paths, tree style
- [ ] usecase.8: invalid editor â†’ shows error, still succeeds
- [ ] usecase.9: empty `--open` â†’ shows error, exits 1
