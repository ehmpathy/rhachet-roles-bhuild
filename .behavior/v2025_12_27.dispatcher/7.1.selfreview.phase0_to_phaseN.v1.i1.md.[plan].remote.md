# plan: B4 remote source support

## problem

B4 blocker: gather does not support remote sources (no GitHub API integration)

## incorrect approach (reverted)

added `pr_labels?: string[]` and `issue_labels?: string[]` to `BehaviorSourceRepoRemote` as configurable options.

this is wrong because:
- these labels should be hardcoded conventions, not user config
- `pr_labels = ["behavior"]` is the standard convention
- `issue_labels = ["behavior.wish"]` is the standard convention
- config should only specify: org, repo, branch

## correct approach (IMPLEMENTED)

### 1. revert BehaviorSourceRepoRemote.ts ✅

removed pr_labels and issue_labels from the interface.

final interface:
```ts
export interface BehaviorSourceRepoRemote {
  org: string;
  repo: string;
  branch: string;
}
```

### 2. define label constants ✅

created `src/domain.objects/remoteBehaviorLabels.ts`:
```ts
export const REMOTE_BEHAVIOR_PR_LABELS = ['behavior'] as const;
export const REMOTE_BEHAVIOR_ISSUE_LABELS = ['behavior.wish'] as const;
```

### 3. implement GitHub API operations ✅

created `src/access/sdks/github/`:
- `fetchRemoteRepoBehaviors.ts` - shallow clone repo, discover .behavior/*/ dirs
- `fetchRemotePRBehaviors.ts` - uses `gh api` to fetch PRs, filter by label, clone PR branches
- `fetchRemoteIssueBehaviors.ts` - uses `gh issue list` to fetch issues, creates synthetic wishes

note: uses `gh` CLI for authentication instead of @octokit/rest to avoid adding dependencies

### 4. integrate into gather skill ✅

updated `getAllBehaviorGathered.ts`:
- added remote source scanning loop
- for each remote source:
  - calls fetchRemoteRepoBehaviors (clone main branch)
  - calls fetchRemotePRBehaviors (PRs with "behavior" label)
  - calls fetchRemoteIssueBehaviors (issues with "behavior.wish" label)
- sets sourceType="remote.repo", "remote.pr", or "remote.issue"

### 5. update .gathered.json contract ✅

extended BehaviorGathered interface:
```ts
prNumber?: number;
prBranch?: string;
issueNumber?: number;
```

### 6. add integration tests ✅

created integration tests for all three remote fetch operations:
- `fetchRemoteRepoBehaviors.integration.test.ts` - tests repo cloning and behavior discovery
- `fetchRemotePRBehaviors.integration.test.ts` - tests PR behavior fetching with label filter
- `fetchRemoteIssueBehaviors.integration.test.ts` - tests issue-to-wish conversion

all 6 tests passing.

## status

- B4.1-B4.6: ✅ COMPLETED
