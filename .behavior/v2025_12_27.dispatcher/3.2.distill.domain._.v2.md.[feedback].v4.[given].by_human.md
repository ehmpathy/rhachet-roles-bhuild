emit your response to the feedback into
- .behavior/v2025_12_27.dispatcher/3.2.distill.domain._.v2.md.[feedback].v4.[taken].by_robot.md

1. emit your response checklist
2. exec your response plan
3. emit your response checkoffs into the checklist

---
---
---

# blocker.1


## appendix: getOne/getAll operation naming plan

### analysis: what is the grain of each operation?

| skill      | operation signature                                 | internally calls                                                                          |
| ---------- | --------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| gather     | `getAllBehaviorGathered({ by: { sources } })`       | `getAllBehaviorGathered({ by: { local } })`, `getAllBehaviorGathered({ by: { remote } })` |
| gather     | `getAllBehaviorGathered({ by: { local } })`         | —                                                                                         |
| gather     | `getAllBehaviorGathered({ by: { remote } })`        | —                                                                                         |
| gather     | `getOneBehaviorGathered({ by: { unique } })`        | — (cache lookup)                                                                          |
| deptrace   | `getOneBehaviorDeptraced({ by: { unique } })`       | `getOneBehaviorGathered`                                                                  |
| measure    | `getOneBehaviorMeasured({ by: { unique } })`        | `getOneBehaviorGathered`, `getOneBehaviorDeptraced`                                       |
| triage     | `getAllBehaviorTriaged({ over: { behaviors } })`    | `getOneBehaviorMeasured`                                                                  |
| coordinate | `getAllBehaviorWorkstream({ over: { behaviors } })` | `getAllBehaviorTriaged`                                                                   |

### reasoning

1. **gather**: polymorphic by source type
   - `getAllBehaviorGathered({ by: { sources: BehaviorDispatchConfig['sources'] } })`
     - iterates local + remote, returns all gathered
   - `getAllBehaviorGathered({ by: { local: { repos: RefByUnique<typeof GitDir>[] } } })`
     - enumerates `.behavior/*/` in each local repo
   - `getAllBehaviorGathered({ by: { remote: { repos: BehaviorSourceRepoRemote[] } } })`
     - clones/fetches remote repos, enumerates `.behavior/*/`
   - `getOneBehaviorGathered({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`
     - looks up ONE gathered by its unique key
     - **cache-critical**: wrapped with `withSimpleCacheOnDisk`; ref includes contentHash so unchanged behaviors skip evaluation entirely
     - if not cached: check if contentHash matches current/latest at source
       - if matches latest → fetch fresh, cache, return
       - if not latest → failfast (can't retrieve old uncached versions)

2. **deptrace**: lookup/compute ONE deptraced by its unique key
   - `getOneBehaviorDeptraced({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`
   - BehaviorDeptraced.unique = ['gathered']
   - internally calls `getOneBehaviorGathered` to hydrate gathered entity
   - **cache-critical**: wrapped with `withSimpleCacheOnDisk`; ref includes contentHash so unchanged behaviors skip evaluation entirely

3. **measure**: lookup/compute ONE measured by its unique key
   - `getOneBehaviorMeasured({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`
   - BehaviorMeasured.unique = ['gathered']
   - internally calls `getOneBehaviorGathered` to hydrate gathered
   - internally calls `getOneBehaviorDeptraced` to get deps
   - **cache-critical**: wrapped with `withSimpleCacheOnDisk`; ref includes contentHash so unchanged behaviors skip evaluation entirely

4. **triage**: operates on ALL measured behaviors (collective state)
   - `getAllBehaviorTriaged({ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] }, config })`
   - internally calls `getOneBehaviorMeasured` for each
   - NOT cacheable per-behavior (depends on nowCount, allBehaviors for readiness)

5. **coordinate**: operates on ALL triaged behaviors to form workstreams
   - `getAllBehaviorWorkstream({ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] } })`
   - internally calls `getAllBehaviorTriaged` if needed

### changes required

- [ ] blocker.25: replace `gatherBehavior` with polymorphic `getAllBehaviorGathered`
  - `getAllBehaviorGathered({ by: { sources } })` - from all configured sources
  - `getAllBehaviorGathered({ by: { local } })` - from local repos only
  - `getAllBehaviorGathered({ by: { remote } })` - from remote repos only

- [ ] blocker.26: add `getOneBehaviorGathered({ by: { unique } })`
  - input = `{ by: { unique: RefByUnique<typeof BehaviorGathered> } }`
  - cached on disk for downstream operations to call

- [ ] blocker.27: update `getOneBehaviorDeptraced({ by: { unique } })`
  - input = `{ by: { unique: RefByUnique<typeof BehaviorGathered> } }`
  - internally calls `getOneBehaviorGathered` to hydrate gathered entity
  - cached on disk

- [ ] blocker.28: update `getOneBehaviorMeasured({ by: { unique } })`
  - input = `{ by: { unique: RefByUnique<typeof BehaviorGathered> } }`
  - internally calls `getOneBehaviorGathered` and `getOneBehaviorDeptraced`
  - cached on disk

- [ ] blocker.29: replace `triageBehavior` + `getOneBehaviorTriaged` → `getAllBehaviorTriaged({ over: { behaviors }, config })`
  - input = `{ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] }, config }`
  - internally calls `getOneBehaviorMeasured` for each
  - handles sorting, nowCount, readiness internally
  - NOT cached (collective state)

- [ ] blocker.30: add `getAllBehaviorWorkstream({ over: { behaviors } })`
  - input = `{ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] } }`
  - internally calls `getAllBehaviorTriaged` if needed
  - NOT cached (collective state)

- [ ] blocker.31: update directory structure in section 3 to reflect new operation names

- [ ] blocker.32: update caching examples in section 4 to show the `{ by: { unique } }` pattern

- [ ] blocker.33: remove `deptraceBehavior` and `measureBehavior` as separate skills
  - they become internal to the getOne* operations
  - pipeline simplifies to: gather → measure (calls deptrace) → triage → coordinate

- [ ] blocker.34: wrap cacheable operations with `withSimpleCacheOnDisk`
  - `getOneBehaviorGathered`, `getOneBehaviorDeptraced`, `getOneBehaviorMeasured`
  - cache key derived from `RefByUnique<typeof BehaviorGathered>` (includes contentHash)
  - if ref unchanged → cache hit → no evaluation needed
  - this is why refs are critical: they include contentHash for cache invalidation
  - each operation must include a header comment calling out cache behavior:
    ```ts
    /**
     * .what = retrieves or computes measured behavior by gathered ref
     * .why = scoring behaviors requires deps and content analysis
     * .note = cache-critical: wrapped with withSimpleCacheOnDisk; ref includes
     *         contentHash so unchanged behaviors skip evaluation entirely
     */
    const getOneBehaviorMeasured = withSimpleCacheOnDisk(
      async (input: { by: { unique: RefByUnique<typeof BehaviorGathered> } }) => { ... },
      { dir: context.cacheDir }
    );
    ```


----


same with getAllBehaviorPrioritized too
