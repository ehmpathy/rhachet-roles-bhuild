# feedback.v3.taken - execution phase refactoring

## blocker.1: BehaviorGathered should not persist content inline

### understanding

the feedback correctly identifies that:
1. `wish`, `vision`, `criteria` inline strings bloat `BehaviorGathered` in memory
2. `BehaviorGatheredFile[]` with `{ path, content }` duplicates file content
3. operations needing content should call `.get()` on file refs instead

the pattern should follow `RefByUnique<typeof GitFile>[]` - lightweight refs that can be dereferenced on-demand.

### response checklist

- [ ] 1. remove `wish`, `vision`, `criteria` from `BehaviorGathered` interface
- [ ] 2. replace `BehaviorGatheredFile[]` with `RefByUnique<typeof GitFile>[]`
- [ ] 3. update `parseBehaviorDir` to return refs instead of content
- [ ] 4. update `getAllBehaviorGathered` file writing to use refs
- [ ] 5. update consumers (deptrace, measure) to `.get()` content when needed
- [ ] 6. update tests to work with new ref-based pattern
- [ ] 7. run `npm run test:types` to verify
- [ ] 8. run `npm run test:integration` to verify

### implementation plan

**phase 1: domain object refactoring**
- remove inline content fields from `BehaviorGathered`
- define `files: RefByUnique<typeof GitFile>[]` for lightweight refs
- keep `contentHash` for cache invalidation (computed from file refs)

**phase 2: gather operation updates**
- `parseBehaviorDir` returns `{ uri: string }` refs instead of `{ path, content }`
- content hash computed by reading files transiently during gather
- output files still written to cache dir for persistence

**phase 3: consumer updates**
- deptrace/measure operations read file content via `fs.readFile(file.uri)`
- or use a helper like `getFileContent({ file }: { file: RefByUnique<typeof GitFile> })`

---

## execution log

