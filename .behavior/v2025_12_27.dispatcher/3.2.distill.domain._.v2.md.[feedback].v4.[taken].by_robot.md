# feedback response: domain distillation v2 → v3 (operation naming)

## checklist

- [x] blocker.25: replace `gatherBehavior` with polymorphic `getAllBehaviorGathered` ✓
- [x] blocker.26: add `getOneBehaviorGathered({ by: { unique } })` ✓
- [x] blocker.27: update `getOneBehaviorDeptraced({ by: { unique } })` ✓
- [x] blocker.28: update `getOneBehaviorMeasured({ by: { unique } })` ✓
- [x] blocker.29: replace `triageBehavior` → `getAllBehaviorTriaged({ over: { behaviors } })` ✓
- [x] blocker.30: add `getAllBehaviorWorkstream({ over: { behaviors } })` ✓
- [x] blocker.35: replace `prioritizeBehavior` → `getAllBehaviorPrioritized({ over: { behaviors } })` ✓
- [x] blocker.31: update directory structure in section 3 and 5 ✓
- [x] blocker.32: update caching examples in section 4 ✓
- [x] blocker.33: remove `deptraceBehavior` and `measureBehavior` as separate skills ✓
- [x] blocker.34: wrap cacheable operations with `withSimpleCacheOnDisk` + cache-critical comments ✓

---

## response plan

### blocker.25: polymorphic getAllBehaviorGathered

replace `gatherBehavior` with polymorphic `getAllBehaviorGathered`:
- `getAllBehaviorGathered({ by: { sources } })` - from all configured sources
- `getAllBehaviorGathered({ by: { local } })` - from local repos only
- `getAllBehaviorGathered({ by: { remote } })` - from remote repos only

### blocker.26: getOneBehaviorGathered

add `getOneBehaviorGathered({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`:
- looks up ONE gathered by its unique key
- **cache-critical**: wrapped with `withSimpleCacheOnDisk`
- if not cached: check if contentHash matches current/latest at source
  - if matches latest → fetch fresh, cache, return
  - if not latest → failfast (can't retrieve old uncached versions)

### blocker.27: getOneBehaviorDeptraced

update to `getOneBehaviorDeptraced({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`:
- internally calls `getOneBehaviorGathered` to hydrate gathered entity
- **cache-critical**: wrapped with `withSimpleCacheOnDisk`

### blocker.28: getOneBehaviorMeasured

update to `getOneBehaviorMeasured({ by: { unique: RefByUnique<typeof BehaviorGathered> } })`:
- internally calls `getOneBehaviorGathered` to hydrate gathered
- internally calls `getOneBehaviorDeptraced` to get deps
- **cache-critical**: wrapped with `withSimpleCacheOnDisk`

### blocker.29: getAllBehaviorTriaged

replace `triageBehavior` with `getAllBehaviorTriaged({ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] }, config })`:
- internally calls `getOneBehaviorMeasured` for each
- handles sorting, nowCount, readiness internally
- **cache-critical**: refs include contentHashes so unchanged behavior set skips evaluation

### blocker.30: getAllBehaviorWorkstream

add `getAllBehaviorWorkstream({ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] } })`:
- internally calls `getAllBehaviorTriaged` if needed
- **cache-critical**: refs include contentHashes so unchanged behavior set skips evaluation

### blocker.35: getAllBehaviorPrioritized

replace `prioritizeBehavior` with `getAllBehaviorPrioritized({ over: { behaviors: RefByUnique<typeof BehaviorGathered>[] } })`:
- internally calls `getAllBehaviorTriaged` for triage
- renders prioritization outputs (md, json, dependencies)
- **cache-critical**: refs include contentHashes so unchanged behavior set skips evaluation

### blocker.31: directory structure

update section 3 and 5 directory structure to reflect new operation names:
- remove `gatherBehavior.ts`, `deptraceBehavior.ts`, `measureBehavior.ts`, `triageBehavior.ts`, `prioritizeBehavior.ts`, `coordinateBehavior.ts`
- add `getAllBehaviorGathered.ts`, `getOneBehaviorGathered.ts`
- add `getOneBehaviorDeptraced.ts`, `getOneBehaviorMeasured.ts`
- add `getAllBehaviorTriaged.ts`, `getAllBehaviorPrioritized.ts`, `getAllBehaviorWorkstream.ts`

### blocker.32: caching examples

update section 4 caching examples to show:
- `{ by: { unique: RefByUnique<typeof BehaviorGathered> } }` pattern
- cache-critical header comments

### blocker.33: remove separate skills

remove `deptraceBehavior` and `measureBehavior` as separate skills:
- they become internal to the `getOne*` operations
- pipeline simplifies to: gather → measure (calls deptrace) → triage → coordinate

### blocker.34: cache-critical comments

each cacheable operation must include header comment:
```ts
/**
 * .what = retrieves or computes X by gathered ref
 * .why = ...
 * .note = cache-critical: wrapped with withSimpleCacheOnDisk; ref includes
 *         contentHash so unchanged behaviors skip evaluation entirely
 */
```
